!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.nonogram=e():t.nonogram=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={exports:{},id:n,loaded:!1};return t[n].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Game=e.Editor=e.Solver=void 0;var r=i(5),s=n(r),o=i(3),a=n(o),h=i(4),l=n(h);e.Solver=s["default"],e.Editor=a["default"],e.Game=l["default"]},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]={greyVeryLight:"#ccc",grey:"#555",greyVeryDark:"#111",blue:"#0ebeff",green:"#47cf73",violet:"#ae63e4",yellow:"#fcd000",red:"#ff3c41"}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){var i=[],n=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(h){r=!0,s=h}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw s}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),h=n(a),l=function(){function t(){r(this,t),this.theme={filledColor:h["default"].grey,unsetColor:h["default"].greyVeryLight,correctColor:h["default"].green,wrongColor:h["default"].red,meshColor:h["default"].yellow,isMeshed:!1,isBoldMeshOnly:!1,isMeshOnTop:!1,boldMeshGap:5}}return o(t,[{key:"initCanvas",value:function(t){var e=this;this.canvas=t instanceof HTMLCanvasElement?t:document.getElementById(t),this.canvas instanceof HTMLCanvasElement||(this.canvas=document.createElement("canvas")),this.canvas.width=this.theme.width||this.canvas.clientWidth,this.canvas.height=this.canvas.width*(this.m+1)/(this.n+1),this.canvas.nonogram&&this.canvas.nonogram.listeners.forEach(function(t){var i=s(t,2),n=i[0],r=i[1];e.canvas.removeEventListener(n,r)}),this.canvas.nonogram=this,this.initListeners(),this.listeners.forEach(function(t){var i=s(t,2),n=i[0],r=i[1];e.canvas.addEventListener(n,r)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}}},{key:"initListeners",value:function(){this.listeners=[]}},{key:"removeNonPositiveHints",value:function(){function t(t,e,i){i[e]=t.filter(function(t){return t>0})}this.hints.row.forEach(t),this.hints.column.forEach(t)}},{key:"getSingleLine",value:function(t,e){var i=[];if("row"===t)for(var n=0;n<this.n;n+=1)i[n]=this.grid[e][n];else if("column"===t)for(var r=0;r<this.m;r+=1)i[r]=this.grid[r][e];return i}},{key:"calculateHints",value:function(e,i){var n=[],r=this.getSingleLine(e,i);return r.reduce(function(e,i){return i===t.FILLED&&n.push(e?n.pop()+1:1),i===t.FILLED},!1),n}},{key:"isLineCorrect",value:function(t,e){return this.calculateHints(t,e).toString()===this.hints[t][e].toString()}},{key:"getLocation",value:function(t,e){var i=this.canvas.getBoundingClientRect(),n=i.width,r=i.height,s=2*n/3,o=2*r/3,a=s/(this.n+1);return t<0||t>=n||e<0||e>=r?"outside":t>=0&&t<=s&&e>=0&&e<o?a/2<=t&&t<s-a/2&&a/2<=e&&e<o-a/2?"grid":"limbo":s<=t&&t<n&&o<=e&&e<r?"controller":"hints"}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printController&&this.printController()}},{key:"printGrid",value:function(){var t=this.canvas.getContext("2d"),e=this.canvas.width,i=this.canvas.height,n=2*e/3/(this.n+1);t.clearRect(-1,-1,2*e/3+1,2*i/3+1),this.theme.isMeshed&&!this.theme.isMeshOnTop&&this.printMesh(),t.save(),t.translate(n/2,n/2);for(var r=0;r<this.m;r+=1)for(var s=0;s<this.n;s+=1)t.save(),t.translate(n*s,n*r),this.printCell(this.grid[r][s]),t.restore();t.restore(),this.theme.isMeshed&&this.theme.isMeshOnTop&&this.printMesh()}},{key:"printCell",value:function(e){var i=this.canvas.getContext("2d"),n=2*this.canvas.width/3/(this.n+1);switch(e){case t.UNSET:i.fillStyle=this.theme.unsetColor,i.fillRect(.05*n,.05*n,.9*n,.9*n);break;case t.FILLED:i.fillStyle=this.theme.filledColor,i.fillRect(.05*-n,.05*-n,1.1*n,1.1*n);break;default:return}}},{key:"printMesh",value:function(){var t=this.canvas.getContext("2d"),e=2*this.canvas.width/3/(this.n+1);t.save(),t.translate(e/2,e/2),t.beginPath();for(var i=1;i<this.m;i+=1)this.theme.isBoldMeshOnly||(t.moveTo(0,i*e),t.lineTo(this.n*e,i*e)),i%this.theme.boldMeshGap===0&&(t.moveTo(0,i*e),t.lineTo(this.n*e,i*e),this.theme.isBoldMeshOnly||(t.moveTo(0,i*e-1),t.lineTo(this.n*e,i*e-1),t.moveTo(0,i*e+1),t.lineTo(this.n*e,i*e+1)));for(var n=1;n<this.n;n+=1)this.theme.isBoldMeshOnly||(t.moveTo(n*e,0),t.lineTo(n*e,this.m*e)),n%this.theme.boldMeshGap===0&&(t.moveTo(n*e,0),t.lineTo(n*e,this.m*e),this.theme.isBoldMeshOnly||(t.moveTo(n*e-1,0),t.lineTo(n*e-1,this.m*e),t.moveTo(n*e+1,0),t.lineTo(n*e+1,this.m*e)));t.lineWidth=1,t.strokeStyle=this.theme.meshColor,t.stroke(),t.restore()}},{key:"printHints",value:function(){var t=this.canvas.getContext("2d"),e=this.canvas.width,i=this.canvas.height,n=2*e/3/(this.n+1);t.clearRect(2*e/3-1,-1,3*e+1,2*i/3+1),t.clearRect(-1,2*i/3-1,2*e/3+1,i/3+1),t.save(),t.translate(n/2,n/2);for(var r=0;r<this.m;r+=1){for(var s=0;s<this.hints.row[r].length;s+=1)this.printSingleHint("row",r,s);0===this.hints.row[r].length&&this.printSingleHint("row",r,0)}for(var o=0;o<this.n;o+=1){for(var a=0;a<this.hints.column[o].length;a+=1)this.printSingleHint("column",o,a);0===this.hints.column[o].length&&this.printSingleHint("column",o,0)}t.restore()}},{key:"printSingleHint",value:function(t,e,i){var n=this.canvas.getContext("2d"),r=this.canvas.width,s=this.canvas.height,o=2*r/3/(this.n+1);n.textAlign="center",n.textBaseline="middle",n.font=o+'pt "Courier New", Inconsolata, Consolas, monospace';var a=this.hints[t][e];n.fillStyle=a.isCorrect?this.theme.correctColor:this.theme.wrongColor,n.globalAlpha=!a.isCorrect&&a.unchanged?.5:1,"row"===t?n.fillText(this.hints.row[e][i]||0,2*r/3+o*i,o*(e+.5),.8*o):"column"===t&&n.fillText(this.hints.column[e][i]||0,o*(e+.5),2*s/3+o*i,.8*o)}}]),t}();e["default"]=l,l.FILLED=!0,l.UNSET=void 0,l.EMPTY=!1},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=i(2),l=n(h),c=i(1),u=n(c),f=function(t){function e(t,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=o.theme,h=o.grid,l=o.threshold,c=void 0===l?.5:l,f=o.onHintChange,d=void 0===f?function(){}:f;r(this,e);var v=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));v.theme.filledColor=u["default"].violet,v.theme.correctColor=u["default"].violet,Object.assign(v.theme,a),v.threshold=c,v.handleHintChange=d,v.m=t,v.n=i,v.grid=new Array(v.m);for(var m=0;m<v.m;m+=1){v.grid[m]=new Array(v.n);for(var g=0;g<v.n;g+=1)h?v.grid[m][g]=h[m][g]?e.FILLED:e.EMPTY:v.grid[m][g]=Math.random()<v.threshold?e.FILLED:e.EMPTY}v.hints={row:new Array(t),column:new Array(i)};for(var w=0;w<v.m;w+=1)v.hints.row[w]=v.calculateHints("row",w),v.hints.row[w].isCorrect=!0;for(var p=0;p<v.n;p+=1)v.hints.column[p]=v.calculateHints("column",p),v.hints.column[p].isCorrect=!0;return v.initCanvas(n),v.draw={},v.print(),v.handleHintChange(v.hints.row,v.hints.column),v}return o(e,t),a(e,[{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown.bind(this)],["mousemove",this.mousemove.bind(this)],["mouseup",this.brushUp.bind(this)],["mouseleave",this.brushUp.bind(this)]]}},{key:"mousedown",value:function(t){var i=this.canvas.getBoundingClientRect(),n=t.clientX-i.left,r=t.clientY-i.top,s=2*i.width/3/(this.n+1),o=this.getLocation(n,r);if("controller"===o)this.refresh();else if("grid"===o){this.draw.firstI=Math.floor(r/s-.5),this.draw.firstJ=Math.floor(n/s-.5);var a=this.grid[this.draw.firstI][this.draw.firstJ];this.draw.brush=a===e.FILLED?e.EMPTY:e.FILLED,this.isPressed=!0,this.switchCell(this.draw.firstI,this.draw.firstJ),this.draw.lastI=this.draw.firstI,this.draw.lastJ=this.draw.firstJ}}},{key:"mousemove",value:function(t){if(this.isPressed){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,r=2*e.width/3/(this.n+1);if("grid"===this.getLocation(i,n)){var s=Math.floor(n/r-.5),o=Math.floor(i/r-.5);s===this.draw.lastI&&o===this.draw.lastJ||(void 0===this.draw.direction&&(s===this.draw.firstI?this.draw.direction="row":o===this.draw.firstJ&&(this.draw.direction="column")),("row"===this.draw.direction&&s===this.draw.firstI||"column"===this.draw.direction&&o===this.draw.firstJ)&&(this.switchCell(s,o),this.draw.lastI=s,this.draw.lastJ=o))}}}},{key:"brushUp",value:function(){delete this.isPressed,this.draw={}}},{key:"switchCell",value:function(t,e){this.grid[t][e]=this.draw.brush,this.hints.row[t]=this.calculateHints("row",t),this.hints.row[t].isCorrect=!0,this.hints.column[e]=this.calculateHints("column",e),this.hints.column[e].isCorrect=!0,this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"refresh",value:function(){for(var t=0;t<this.m;t+=1)for(var i=0;i<this.n;i+=1)this.grid[t][i]=Math.random()<this.threshold?e.FILLED:e.EMPTY;for(var n=0;n<this.m;n+=1)this.hints.row[n]=this.calculateHints("row",n),this.hints.row[n].isCorrect=!0;for(var r=0;r<this.n;r+=1)this.hints.column[r]=this.calculateHints("column",r),this.hints.column[r].isCorrect=!0;this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=r/10;t.width=r,t.height=r;var i=t.getContext("2d");return i.translate(r/2,r/2),i.arc(0,0,r/2-e/2,Math.PI/2,Math.PI/3.9),i.lineWidth=e,i.strokeStyle=s,i.stroke(),i.beginPath(),i.moveTo((r/2+e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),i.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2-2*e)*Math.SQRT1_2),i.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),i.closePath(),i.fillStyle=s,i.fill(),t}var e=this.canvas.getContext("2d"),i=this.canvas.width,n=this.canvas.height,r=Math.min(i,n)/4,s=this.theme.filledColor;e.clearRect(2*i/3-1,2*n/3-1,i/3+1,n/3+1),e.save(),e.translate(.7*i,.7*n),e.drawImage(t(),0,0),e.restore()}}]),e}(l["default"]);e["default"]=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var i=[],n=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(h){r=!0,s=h}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw s}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(2),c=n(l),u=i(1),f=n(u),d=function(t,e){return t.toString()===e.toString()},v=function(t){function e(t,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=o.theme,h=o.onSuccess,l=void 0===h?function(){}:h,c=o.onAnimationEnd,u=void 0===c?function(){}:c;r(this,e);var d=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));d.theme.filledColor=f["default"].blue,d.theme.emptyColor=f["default"].red,d.theme.wrongColor=f["default"].grey,d.theme.isMeshed=!0,Object.assign(d.theme,a),d.handleSuccess=l,d.handleAnimationEnd=u,d.hints={row:t.slice(),column:i.slice()},d.removeNonPositiveHints(),d.m=d.hints.row.length,d.n=d.hints.column.length,d.grid=new Array(d.m);for(var v=0;v<d.m;v+=1)d.grid[v]=new Array(d.n).fill(e.UNSET);return d.hints.row.forEach(function(t,e){t.isCorrect=d.isLineCorrect("row",e)}),d.hints.column.forEach(function(t,e){t.isCorrect=d.isLineCorrect("column",e)}),d.initCanvas(n),d.brush=e.FILLED,d.draw={},d.print(),d}return o(e,t),h(e,[{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown.bind(this)],["mousemove",this.mousemove.bind(this)],["mouseup",this.brushUp.bind(this)],["mouseleave",this.brushUp.bind(this)]]}},{key:"mousedown",value:function(t){var i=this.canvas.getBoundingClientRect(),n=t.clientX-i.left,r=t.clientY-i.top,s=2*i.width/3/(this.n+1),o=this.getLocation(n,r);if("controller"===o)this.switchBrush();else if("grid"===o){this.draw.firstI=Math.floor(r/s-.5),this.draw.firstJ=Math.floor(n/s-.5),this.draw.inverted=2===t.button;var a=this.grid[this.draw.firstI][this.draw.firstJ],h=this.brush;this.draw.inverted&&(h=this.brush===e.FILLED?e.EMPTY:e.FILLED),a!==e.UNSET&&h!==a||(this.draw.mode=h===a?"empty":"filling",this.isPressed=!0,this.switchCell(this.draw.firstI,this.draw.firstJ)),this.draw.lastI=this.draw.firstI,this.draw.lastJ=this.draw.firstJ}}},{key:"mousemove",value:function(t){if(this.isPressed){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,r=2*e.width/3/(this.n+1);if("grid"===this.getLocation(i,n)){var s=Math.floor(n/r-.5),o=Math.floor(i/r-.5);s===this.draw.lastI&&o===this.draw.lastJ||(void 0===this.draw.direction&&(s===this.draw.firstI?this.draw.direction="row":o===this.draw.firstJ&&(this.draw.direction="column")),("row"===this.draw.direction&&s===this.draw.firstI||"column"===this.draw.direction&&o===this.draw.firstJ)&&(this.switchCell(s,o),this.draw.lastI=s,this.draw.lastJ=o))}}}},{key:"switchBrush",value:function(){this.brush=this.brush===e.EMPTY?e.FILLED:e.EMPTY,this.printController()}},{key:"brushUp",value:function(){delete this.isPressed,this.draw={}}},{key:"switchCell",value:function(t,i){var n=this.brush;if(this.draw.inverted&&(n=this.brush===e.FILLED?e.EMPTY:e.FILLED),n===e.FILLED&&this.grid[t][i]!==e.EMPTY){this.grid[t][i]="filling"===this.draw.mode?e.FILLED:e.UNSET,this.hints.row[t].isCorrect=d(this.calculateHints("row",t),this.hints.row[t]),this.hints.column[i].isCorrect=d(this.calculateHints("column",i),this.hints.column[i]),this.print();var r=this.hints.row.every(function(t){return t.isCorrect})&&this.hints.column.every(function(t){return t.isCorrect});r&&this.succeed()}else n===e.EMPTY&&this.grid[t][i]!==e.FILLED&&(this.grid[t][i]="filling"===this.draw.mode?e.EMPTY:e.UNSET,this.print())}},{key:"printCell",value:function(t){var i=this.canvas.getContext("2d"),n=2*this.canvas.width/3/(this.n+1);switch(t){case e.FILLED:i.fillStyle=this.theme.filledColor,i.fillRect(.05*-n,.05*-n,1.1*n,1.1*n);break;case e.EMPTY:i.strokeStyle=this.theme.emptyColor,i.lineWidth=n/15,i.beginPath(),i.moveTo(.3*n,.3*n),i.lineTo(.7*n,.7*n),i.moveTo(.3*n,.7*n),i.lineTo(.7*n,.3*n),i.stroke();break;default:return}}},{key:"printController",value:function(){function t(){n.save(),n.translate(h,0),n.fillStyle=this.theme.meshColor,n.fillRect(0,0,a,a),n.fillStyle=this.theme.filledColor,n.fillRect(l,l,c,c),n.restore()}function i(){n.save(),n.translate(0,h),n.fillStyle=this.theme.meshColor,n.fillRect(0,0,a,a),n.clearRect(l,l,c,c),n.strokeStyle=f["default"].red,n.lineWidth=l,n.beginPath(),n.moveTo(.3*a,.3*a),n.lineTo(.7*a,.7*a),n.moveTo(.3*a,.7*a),n.lineTo(.7*a,.3*a),n.stroke(),n.restore()}var n=this.canvas.getContext("2d"),r=this.canvas.width,s=this.canvas.height,o=Math.min(r,s)/4,a=3*o/4,h=o/4,l=o/20,c=a-2*l;n.clearRect(2*r/3-1,2*s/3-1,r/3+1,s/3+1),n.save(),n.translate(.7*r,.7*s),this.brush===e.FILLED?(i.call(this),t.call(this)):this.brush===e.EMPTY&&(t.call(this),i.call(this)),n.restore()}},{key:"succeed",value:function(){function t(){var t=2*h,e=t/10,i=document.createElement("canvas");i.width=t,i.height=t;var n=i.getContext("2d");return n.translate(t/3,5*t/6),n.rotate(-Math.PI/4),n.fillStyle=f["default"].green,n.fillRect(0,0,e,-t*Math.SQRT2/3),n.fillRect(0,0,t*Math.SQRT2*2/3,-e),i}function e(t){return 1+Math.pow(t-1,3)}function i(){r.putImageData(l,0,0),u+=.03,r.globalAlpha=e(u),r.clearRect(2*s/3,2*o/3,s/3,o/3),r.drawImage(c,.7*s-(1-e(u))*h/2,.7*o-(1-e(u))*h/2,(2-e(u))*h,(2-e(u))*h),u<=1?requestAnimationFrame(i.bind(this)):this.handleAnimationEnd()}var n=this;this.handleSuccess(),this.listeners.forEach(function(t){var e=a(t,2),i=e[0],r=e[1];n.canvas.removeEventListener(i,r)});var r=this.canvas.getContext("2d"),s=this.canvas.width,o=this.canvas.height,h=Math.min(s,o)/4,l=r.getImageData(0,0,s,o),c=t(),u=0;i.call(this)}}]),e}(c["default"]);e["default"]=v},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function r(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(2),c=n(l),u=i(1),f=n(u),d=function(t){return t.reduce(function(t,e){return t+e},0)},v=function(t){function e(t,i,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=r.theme,h=r.demoMode,l=void 0===h||h,c=r.delay,u=void 0===c?50:c,d=r.onSuccess,v=void 0===d?function(){}:d,m=r.onError,g=void 0===m?function(){}:m;s(this,e);var w=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));w.theme.filledColor=f["default"].green,w.theme.correctColor=f["default"].green,w.theme.wrongColor=f["default"].yellow,Object.assign(w.theme,a),w.demoMode=l,w.delay=u,w.handleSuccess=v,w.handleError=g,w.hints={row:t.slice(),column:i.slice()},w.removeNonPositiveHints(),w.m=w.hints.row.length,w.n=w.hints.column.length,w.grid=new Array(w.m);for(var p=0;p<w.m;p+=1)w.grid[p]=new Array(w.n);return w.hints.row.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),w.hints.column.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),w.initCanvas(n),w.print(),w}return a(e,t),h(e,[{key:"initListeners",value:function(){this.listeners=[["click",this.click.bind(this)]]}},{key:"click",value:function(t){if(!this.isBusy){var i=this.canvas.getBoundingClientRect(),n=t.clientX-i.left,r=t.clientY-i.top,s=2*i.width/3/(this.n+1),o=this.getLocation(n,r);if("grid"===o){if(this.scanner&&this.scanner.error)return;var a=Math.floor(r/s-.5),h=Math.floor(n/s-.5);this.grid[a][h]===e.UNSET&&(this.grid[a][h]=e.FILLED,this.hints.row[a].unchanged=!1,this.hints.column[h].unchanged=!1,this.solve())}else"controller"===o&&this.refresh()}}},{key:"refresh",value:function(){if(!this.isBusy){this.grid=new Array(this.m);for(var t=0;t<this.m;t+=1)this.grid[t]=new Array(this.n);this.hints.row.forEach(function(t){t.isCorrect=!1,t.unchanged=!1,delete t.possibleBlanks}),this.hints.column.forEach(function(t){t.isCorrect=!1,t.unchanged=!1,delete t.possibleBlanks}),delete this.scanner,this.solve()}}},{key:"solve",value:function(){this.isBusy||(this.isBusy=!0,this.startTime=Date.now(),this.scan())}},{key:"scan",value:function(){if(this.canvas.nonogram===this&&(this.updateScanner(),void 0!==this.scanner))return this.demoMode&&this.print(),this.scanner.error=!0,this.solveSingleLine(),this.scanner.error?(this.isBusy=!1,this.print(),void this.handleError(new Error("Bad hints at "+this.scanner.direction+" "+(this.scanner.i+1)))):void(this.demoMode?setTimeout(this.scan.bind(this),this.delay):this.scan())}},{key:"updateScanner",value:function(){var t=void 0;do if(void 0===this.scanner?this.scanner={direction:"row",i:0}:(this.scanner.error=!1,this.scanner.i+=1,void 0===this.hints[this.scanner.direction][this.scanner.i]&&(this.scanner.direction="row"===this.scanner.direction?"column":"row",this.scanner.i=0)),t=this.hints[this.scanner.direction][this.scanner.i],this.hints.row.every(function(t){return t.unchanged})&&this.hints.column.every(function(t){return t.unchanged}))return delete this.scanner,this.isBusy=!1,this.print(),void this.handleSuccess(Date.now()-this.startTime);while(t.isCorrect||t.unchanged)}},{key:"solveSingleLine",value:function(){var t=this.scanner,i=t.direction,n=t.i;this.scanner.hints=this.hints[i][n],this.scanner.hints.unchanged=!0,this.scanner.line=this.getSingleLine(i,n);var r=this.scanner.line.every(function(t){return t!==e.UNSET});r||(void 0===this.scanner.hints.possibleBlanks&&(this.scanner.hints.possibleBlanks=[],this.getAllSituations(this.scanner.line.length-d(this.scanner.hints)+1)),this.mergeSituation(),this.setBackToGrid()),this.isLineCorrect(i,n)&&(this.hints[i][n].isCorrect=!0,r&&(this.scanner.error=!1))}},{key:"getAllSituations",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(i===this.scanner.hints.length){var n=e.slice(0,this.scanner.hints.length);n[0]-=1,this.scanner.hints.possibleBlanks.push(n)}for(var r=1;r<=t;r+=1)e[i]=r,this.getAllSituations(t-e[i],e,i+1)}},{key:"mergeSituation",value:function(){var t=this,i=this.scanner.hints.possibleBlanks;i.forEach(function(n,s){for(var o=[],a=0;a<t.scanner.hints.length;a+=1)o.push.apply(o,r(new Array(n[a]).fill(e.TEMP_EMPTY))),o.push.apply(o,r(new Array(t.scanner.hints[a]).fill(e.TEMP_FILLED)));o.push.apply(o,r(new Array(t.scanner.line.length-o.length).fill(e.TEMP_EMPTY)));var h=o.some(function(i,n){return i===e.TEMP_EMPTY&&t.scanner.line[n]===e.FILLED||i===e.TEMP_FILLED&&t.scanner.line[n]===e.EMPTY});return h?void(i[s]=null):(t.scanner.error=!1,void o.forEach(function(i,n){i===e.TEMP_FILLED?t.scanner.line[n]===e.TEMP_EMPTY?t.scanner.line[n]=e.INCONSTANT:t.scanner.line[n]===e.UNSET&&(t.scanner.line[n]=e.TEMP_FILLED):i===e.TEMP_EMPTY&&(t.scanner.line[n]===e.TEMP_FILLED?t.scanner.line[n]=e.INCONSTANT:t.scanner.line[n]===e.UNSET&&(t.scanner.line[n]=e.TEMP_EMPTY))}))}),this.scanner.hints.possibleBlanks=i.filter(function(t){return null!==t})}},{key:"setBackToGrid",value:function(){var t=this,i=this.scanner,n=i.direction,r=i.i;"row"===n?this.scanner.line.forEach(function(i,n){e.cellValueMap.has(i)&&t.grid[r][n]!==e.cellValueMap.get(i)&&(t.grid[r][n]=e.cellValueMap.get(i),t.hints.column[n].unchanged=!1)}):"column"===n&&this.scanner.line.forEach(function(i,n){e.cellValueMap.has(i)&&t.grid[n][r]!==e.cellValueMap.get(i)&&(t.grid[n][r]=e.cellValueMap.get(i),t.hints.row[n].unchanged=!1)})}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printController(),this.printScanner()}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=r/10;t.width=r,t.height=r;var i=t.getContext("2d");return i.translate(r/2,r/2),i.rotate(Math.PI),i.arc(0,0,r/2-e/2,Math.PI/2,Math.PI/3.9),i.lineWidth=e,i.strokeStyle=s,i.stroke(),i.beginPath(),i.moveTo((r/2+e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),i.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2-2*e)*Math.SQRT1_2),i.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),i.closePath(),i.fillStyle=s,i.fill(),t}var e=this.canvas.getContext("2d"),i=this.canvas.width,n=this.canvas.height,r=Math.min(i,n)/4,s=this.theme.filledColor;e.clearRect(2*i/3-1,2*n/3-1,i/3+1,n/3+1),this.isBusy||(e.save(),e.translate(.7*i,.7*n),e.drawImage(t(),0,0),e.restore())}},{key:"printScanner",value:function(){if(void 0!==this.scanner){var t=this.canvas.getContext("2d"),e=this.canvas.width,i=this.canvas.height,n=2*e/3/(this.n+1);t.save(),t.translate(n/2,n/2),t.fillStyle=this.scanner.error?this.theme.wrongColor:this.theme.correctColor,t.globalAlpha=.5,"row"===this.scanner.direction?t.fillRect(0,n*this.scanner.i,e,n):"column"===this.scanner.direction&&t.fillRect(n*this.scanner.i,0,n,i),t.restore()}}}]),e}(c["default"]);e["default"]=v,v.TEMP_FILLED=1,v.TEMP_EMPTY=-1,v.INCONSTANT=0,v.cellValueMap=new Map,v.cellValueMap.set(v.TEMP_FILLED,v.FILLED),v.cellValueMap.set(v.TEMP_EMPTY,v.EMPTY),v.cellValueMap.set(v.INCONSTANT,v.UNSET)}])});