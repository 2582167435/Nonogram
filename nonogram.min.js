!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.nonogram=e():t.nonogram=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=5)}([function(t,e,n){"use strict";e.a={greyVeryLight:"#ccc",grey:"#555",greyVeryDark:"#111",blue:"#0ebeff",green:"#47cf73",violet:"#ae63e4",yellow:"#fcd000",red:"#ff3c41"}},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){return t.length===e.length&&t.every(function(t,n){return t===e[n]})}var o=n(0),s=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=function(){function t(){i(this,t),this.theme={filledColor:o.a.grey,unsetColor:o.a.greyVeryLight,correctColor:o.a.green,wrongColor:o.a.red,meshColor:o.a.yellow,isMeshed:!1,isBoldMeshOnly:!1,isMeshOnTop:!1,boldMeshGap:5}}return a(t,[{key:"initCanvas",value:function(t){var e=this,n=t instanceof HTMLCanvasElement?t:document.getElementById(t);n instanceof HTMLCanvasElement||(n=document.createElement("canvas")),this.canvas=n,this.canvas.nonogram&&this.canvas.nonogram.listeners.forEach(function(t){var n=s(t,2),i=n[0],r=n[1];e.canvas.removeEventListener(i,r)}),this.canvas.nonogram=this,this.canvas.width=this.theme.width||this.canvas.clientWidth,this.canvas.height=this.canvas.width*(this.m+1)/(this.n+1),this.ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.initListeners(),this.listeners.forEach(function(t){var n=s(t,2),i=n[0],r=n[1];e.canvas.addEventListener(i,r)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}}},{key:"initListeners",value:function(){this.listeners=[]}},{key:"removeNonPositiveHints",value:function(){function t(t,e,n){n[e]=t.filter(function(t){return t>0})}this.hints.row.forEach(t),this.hints.column.forEach(t)}},{key:"getSingleLine",value:function(t,e){var n=[];if("row"===t)for(var i=0;i<this.n;i+=1)n[i]=this.grid[e][i];else if("column"===t)for(var r=0;r<this.m;r+=1)n[r]=this.grid[r][e];return n}},{key:"calculateHints",value:function(t,e){var n=[];return this.getSingleLine(t,e).reduce(function(t,e){if(1===e)n.push(t?n.pop()+1:1);else if(0!==e)throw new Error;return 1===e},!1),n}},{key:"isLineCorrect",value:function(t,e){try{return r(this.calculateHints(t,e),this.hints[t][e])}catch(t){return!1}}},{key:"getLocation",value:function(t,e){var n=this.canvas.getBoundingClientRect(),i=n.width,r=n.height,o=2*i/3,s=2*r/3,a=o/(this.n+1);return t<0||t>=i||e<0||e>=r?"outside":t>=0&&t<=o&&e>=0&&e<s?a/2<=t&&t<o-a/2&&a/2<=e&&e<s-a/2?"grid":"limbo":o<=t&&t<i&&s<=e&&e<r?"controller":"hints"}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printController()}},{key:"printGrid",value:function(){var t=this.ctx,e=this.canvas,n=e.width,i=e.height,r=2*n/3/(this.n+1);t.clearRect(-1,-1,2*n/3+1,2*i/3+1),this.theme.isMeshed&&!this.theme.isMeshOnTop&&this.printMesh(),t.save(),t.translate(r/2,r/2);for(var o=0;o<this.m;o+=1)for(var s=0;s<this.n;s+=1)t.save(),t.translate(r*s,r*o),this.printCell(this.grid[o][s]),t.restore();t.restore(),this.theme.isMeshed&&this.theme.isMeshOnTop&&this.printMesh()}},{key:"printCell",value:function(t){var e=this.ctx,n=2*this.canvas.width/3/(this.n+1);switch(t){case 2:e.fillStyle=this.theme.unsetColor,e.fillRect(.05*n,.05*n,.9*n,.9*n);break;case 1:e.fillStyle=this.theme.filledColor,e.fillRect(.05*-n,.05*-n,1.1*n,1.1*n)}}},{key:"printMesh",value:function(){var t=this.ctx,e=2*this.canvas.width/3/(this.n+1);t.save(),t.translate(e/2,e/2),t.beginPath();for(var n=1;n<this.m;n+=1)this.theme.isBoldMeshOnly||(t.moveTo(0,n*e),t.lineTo(this.n*e,n*e)),n%this.theme.boldMeshGap==0&&(t.moveTo(0,n*e),t.lineTo(this.n*e,n*e),this.theme.isBoldMeshOnly||(t.moveTo(0,n*e-1),t.lineTo(this.n*e,n*e-1),t.moveTo(0,n*e+1),t.lineTo(this.n*e,n*e+1)));for(var i=1;i<this.n;i+=1)this.theme.isBoldMeshOnly||(t.moveTo(i*e,0),t.lineTo(i*e,this.m*e)),i%this.theme.boldMeshGap==0&&(t.moveTo(i*e,0),t.lineTo(i*e,this.m*e),this.theme.isBoldMeshOnly||(t.moveTo(i*e-1,0),t.lineTo(i*e-1,this.m*e),t.moveTo(i*e+1,0),t.lineTo(i*e+1,this.m*e)));t.lineWidth=1,t.strokeStyle=this.theme.meshColor,t.stroke(),t.restore()}},{key:"printHints",value:function(){var t=this.ctx,e=this.canvas,n=e.width,i=e.height,r=2*n/3/(this.n+1);t.clearRect(2*n/3-1,-1,3*n+1,2*i/3+1),t.clearRect(-1,2*i/3-1,2*n/3+1,i/3+1),t.save(),t.translate(r/2,r/2);for(var o=0;o<this.m;o+=1){for(var s=0;s<this.hints.row[o].length;s+=1)this.printSingleHint("row",o,s);0===this.hints.row[o].length&&this.printSingleHint("row",o,0)}for(var a=0;a<this.n;a+=1){for(var l=0;l<this.hints.column[a].length;l+=1)this.printSingleHint("column",a,l);0===this.hints.column[a].length&&this.printSingleHint("column",a,0)}t.restore()}},{key:"printSingleHint",value:function(t,e,n){var i=this.ctx,r=this.canvas,o=r.width,s=r.height,a=2*o/3/(this.n+1);i.textAlign="center",i.textBaseline="middle",i.font=a+'pt "Courier New", Inconsolata, Consolas, monospace';var l=this.hints[t][e];i.fillStyle=l.isCorrect?this.theme.correctColor:this.theme.wrongColor,i.globalAlpha=!l.isCorrect&&l.unchanged?.5:1,"row"===t?i.fillText(""+(this.hints.row[e][n]||0),2*o/3+a*n,a*(e+.5),.8*a):"column"===t&&i.fillText(""+(this.hints.column[e][n]||0),a*(e+.5),2*s/3+a*n,.8*a)}}]),t}();e.a=l},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(1),a=n(0),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),h=function(t){function e(t,n,o){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=s.theme,h=void 0===l?{}:l,c=s.grid,u=void 0===c?[]:c,f=s.threshold,d=void 0===f?.5:f,v=s.onHintChange,m=void 0===v?function(){}:v;i(this,e);var w=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));w.mousedown=function(t){var e=w.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(w.n+1),o=w.getLocation(n,i);if("controller"===o)w.refresh();else if("grid"===o){w.draw.firstI=Math.floor(i/r-.5),w.draw.firstJ=Math.floor(n/r-.5);var s=w.grid[w.draw.firstI][w.draw.firstJ];w.draw.brush=1===s?0:1,w.isPressed=!0,w.paintCell(w.draw.firstI,w.draw.firstJ),w.draw.lastI=w.draw.firstI,w.draw.lastJ=w.draw.firstJ}},w.mousemove=function(t){if(w.isPressed){var e=w.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(w.n+1);if("grid"===w.getLocation(n,i)){var o=Math.floor(i/r-.5),s=Math.floor(n/r-.5);o===w.draw.lastI&&s===w.draw.lastJ||(void 0===w.draw.direction&&(o===w.draw.firstI?w.draw.direction="row":s===w.draw.firstJ&&(w.draw.direction="column")),("row"===w.draw.direction&&o===w.draw.firstI||"column"===w.draw.direction&&s===w.draw.firstJ)&&(w.paintCell(o,s),w.draw.lastI=o,w.draw.lastJ=s))}}},w.brushUp=function(){delete w.isPressed,w.draw={}},w.theme.filledColor=a.a.violet,w.theme.correctColor=a.a.violet,Object.assign(w.theme,h),w.threshold=d,w.handleHintChange=m,w.m=t,w.n=n,w.grid=new Array(w.m);for(var g=0;g<w.m;g+=1){w.grid[g]=new Array(w.n);for(var p=0;p<w.n;p+=1)u.length?w.grid[g][p]=u[g][p]?1:0:w.grid[g][p]=Math.random()<w.threshold?1:0}w.hints={row:new Array(t),column:new Array(n)};for(var y=0;y<w.m;y+=1)w.hints.row[y]=w.calculateHints("row",y),w.hints.row[y].isCorrect=!0;for(var b=0;b<w.n;b+=1)w.hints.column[b]=w.calculateHints("column",b),w.hints.column[b].isCorrect=!0;return w.initCanvas(o),w.draw={},w.print(),w.handleHintChange(w.hints.row,w.hints.column),w}return o(e,t),l(e,[{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown],["mousemove",this.mousemove],["mouseup",this.brushUp],["mouseleave",this.brushUp]]}},{key:"paintCell",value:function(t,e){this.grid[t][e]=this.draw.brush,this.hints.row[t]=this.calculateHints("row",t),this.hints.row[t].isCorrect=!0,this.hints.column[e]=this.calculateHints("column",e),this.hints.column[e].isCorrect=!0,this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"refresh",value:function(){for(var t=0;t<this.m;t+=1)for(var e=0;e<this.n;e+=1)this.grid[t][e]=Math.random()<this.threshold?1:0;for(var n=0;n<this.m;n+=1)this.hints.row[n]=this.calculateHints("row",n),this.hints.row[n].isCorrect=!0;for(var i=0;i<this.n;i+=1)this.hints.column[i]=this.calculateHints("column",i),this.hints.column[i].isCorrect=!0;this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=o/10;t.width=o,t.height=o;var n=t.getContext("2d")||new CanvasRenderingContext2D;return n.translate(o/2,o/2),n.arc(0,0,o/2-e/2,Math.PI/2,Math.PI/3.9),n.lineWidth=e,n.strokeStyle=s,n.stroke(),n.beginPath(),n.moveTo((o/2+e)*Math.SQRT1_2,(o/2+e)*Math.SQRT1_2),n.lineTo((o/2-2*e)*Math.SQRT1_2,(o/2-2*e)*Math.SQRT1_2),n.lineTo((o/2-2*e)*Math.SQRT1_2,(o/2+e)*Math.SQRT1_2),n.closePath(),n.fillStyle=s,n.fill(),t}var e=this.ctx,n=this.canvas,i=n.width,r=n.height,o=Math.min(i,r)/4,s=this.theme.filledColor;e.clearRect(2*i/3-1,2*r/3-1,i/3+1,r/3+1),e.save(),e.translate(.7*i,.7*r),e.drawImage(t(),0,0),e.restore()}}]),e}(s.a);e.a=h},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(1),a=n(0),l=function(){function t(t,e){var n=[],i=!0,r=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&a.return&&a.return()}finally{if(r)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function(t){function e(t,n,o){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=s.theme,h=void 0===l?{}:l,c=s.onSuccess,u=void 0===c?function(){}:c,f=s.onAnimationEnd,d=void 0===f?function(){}:f;i(this,e);var v=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));v.mousedown=function(t){var e=v.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(v.n+1),o=v.getLocation(n,i);if("controller"===o)v.switchBrush();else if("grid"===o){v.draw.firstI=Math.floor(i/r-.5),v.draw.firstJ=Math.floor(n/r-.5),v.draw.inverted=2===t.button;var s=v.grid[v.draw.firstI][v.draw.firstJ],a=v.brush;v.draw.inverted&&(a=1===v.brush?0:1),2!==s&&a!==s||(v.draw.mode=a===s?"empty":"filling",v.isPressed=!0,v.switchCell(v.draw.firstI,v.draw.firstJ)),v.draw.lastI=v.draw.firstI,v.draw.lastJ=v.draw.firstJ}},v.mousemove=function(t){if(v.isPressed){var e=v.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(v.n+1);if("grid"===v.getLocation(n,i)){var o=Math.floor(i/r-.5),s=Math.floor(n/r-.5);o===v.draw.lastI&&s===v.draw.lastJ||(void 0===v.draw.direction&&(o===v.draw.firstI?v.draw.direction="row":s===v.draw.firstJ&&(v.draw.direction="column")),("row"===v.draw.direction&&o===v.draw.firstI||"column"===v.draw.direction&&s===v.draw.firstJ)&&(v.switchCell(o,s),v.draw.lastI=o,v.draw.lastJ=s))}}},v.brushUp=function(){delete v.isPressed,v.draw={}},v.theme.filledColor=a.a.blue,v.theme.wrongColor=a.a.grey,v.theme.isMeshed=!0,Object.assign(v.theme,h),v.handleSuccess=u,v.handleAnimationEnd=d,v.hints={row:t.slice(),column:n.slice()},v.removeNonPositiveHints(),v.m=v.hints.row.length,v.n=v.hints.column.length,v.grid=new Array(v.m);for(var m=0;m<v.m;m+=1)v.grid[m]=new Array(v.n).fill(2);return v.hints.row.forEach(function(t,e){t.isCorrect=v.isLineCorrect("row",e)}),v.hints.column.forEach(function(t,e){t.isCorrect=v.isLineCorrect("column",e)}),v.initCanvas(o),v.brush=1,v.draw={},v.print(),v}return o(e,t),h(e,[{key:"calculateHints",value:function(t,e){var n=[];return this.getSingleLine(t,e).reduce(function(t,e){return 1===e&&n.push(t?n.pop()+1:1),1===e},!1),n}},{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown],["mousemove",this.mousemove],["mouseup",this.brushUp],["mouseleave",this.brushUp]]}},{key:"switchBrush",value:function(){this.brush=0===this.brush?1:0,this.printController()}},{key:"switchCell",value:function(t,e){var n=this.brush;if(this.draw.inverted&&(n=1===this.brush?0:1),1===n&&0!==this.grid[t][e]){this.grid[t][e]="filling"===this.draw.mode?1:2,this.hints.row[t].isCorrect=this.isLineCorrect("row",t),this.hints.column[e].isCorrect=this.isLineCorrect("column",e),this.print();this.hints.row.every(function(t){return!!t.isCorrect})&&this.hints.column.every(function(t){return!!t.isCorrect})&&this.succeed()}else 0===n&&1!==this.grid[t][e]&&(this.grid[t][e]="filling"===this.draw.mode?0:2,this.print())}},{key:"printCell",value:function(t){var e=this.ctx,n=2*this.canvas.width/3/(this.n+1);switch(t){case 1:e.fillStyle=this.theme.filledColor,e.fillRect(.05*-n,.05*-n,1.1*n,1.1*n);break;case 0:e.strokeStyle=a.a.red,e.lineWidth=n/15,e.beginPath(),e.moveTo(.3*n,.3*n),e.lineTo(.7*n,.7*n),e.moveTo(.3*n,.7*n),e.lineTo(.7*n,.3*n),e.stroke()}}},{key:"printController",value:function(){function t(){n.save(),n.translate(h,0),n.fillStyle=this.theme.meshColor,n.fillRect(0,0,l,l),n.fillStyle=this.theme.filledColor,n.fillRect(c,c,u,u),n.restore()}function e(){n.save(),n.translate(0,h),n.fillStyle=this.theme.meshColor,n.fillRect(0,0,l,l),n.clearRect(c,c,u,u),n.strokeStyle=a.a.red,n.lineWidth=c,n.beginPath(),n.moveTo(.3*l,.3*l),n.lineTo(.7*l,.7*l),n.moveTo(.3*l,.7*l),n.lineTo(.7*l,.3*l),n.stroke(),n.restore()}var n=this.ctx,i=this.canvas,r=i.width,o=i.height,s=Math.min(r,o)/4,l=3*s/4,h=s/4,c=s/20,u=l-2*c;n.clearRect(2*r/3-1,2*o/3-1,r/3+1,o/3+1),n.save(),n.translate(.7*r,.7*o),1===this.brush?(e.call(this),t.call(this)):0===this.brush&&(t.call(this),e.call(this)),n.restore()}},{key:"succeed",value:function(){function t(){var t=2*h,e=t/10,n=document.createElement("canvas");n.width=t,n.height=t;var i=n.getContext("2d")||new CanvasRenderingContext2D;return i.translate(t/3,5*t/6),i.rotate(-Math.PI/4),i.fillStyle=a.a.green,i.fillRect(0,0,e,-t*Math.SQRT2/3),i.fillRect(0,0,t*Math.SQRT2*2/3,-e),n}function e(t){return 1+Math.pow(t-1,3)}var n=this;this.handleSuccess(),this.listeners.forEach(function(t){var e=l(t,2),i=e[0],r=e[1];n.canvas.removeEventListener(i,r)});var i=this.ctx,r=this.canvas,o=r.width,s=r.height,h=Math.min(o,s)/4,c=i.getImageData(0,0,o,s),u=t(),f=0;!function t(){i.putImageData(c,0,0),f+=.03,i.globalAlpha=e(f),i.clearRect(2*o/3,2*s/3,o/3,s/3),i.drawImage(u,.7*o-(1-e(f))*h/2,.7*s-(1-e(f))*h/2,(2-e(f))*h,(2-e(f))*h),f<=1?requestAnimationFrame(t):n.handleAnimationEnd()}()}}]),e}(s.a);e.a=c},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var s=n(1),a=n(0),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),h=function(t){function e(t,n,o){var s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=s.theme,h=void 0===l?{}:l,c=s.delay,u=void 0===c?50:c,f=s.onSuccess,d=void 0===f?function(){}:f,v=s.onError,m=void 0===v?function(){}:v;i(this,e);var w=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));w.worker=new Worker("worker.js"),w.click=function(t){if(!w.isBusy){var e=w.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(w.n+1),o=w.getLocation(n,i);if("grid"===o){if(w.isError)return;var s=Math.floor(i/r-.5),a=Math.floor(n/r-.5);2===w.grid[s][a]&&(w.grid[s][a]=1,w.hints.row[s].unchanged=!1,w.hints.column[a].unchanged=!1,w.solve())}else"controller"===o&&w.refresh()}},w.theme.filledColor=a.a.green,w.theme.correctColor=a.a.green,w.theme.wrongColor=a.a.yellow,Object.assign(w.theme,h),w.delay=u,w.handleSuccess=d,w.handleError=m,w.hints={row:t.slice(),column:n.slice()},w.removeNonPositiveHints(),w.m=w.hints.row.length,w.n=w.hints.column.length,w.grid=new Array(w.m);for(var g=0;g<w.m;g+=1)w.grid[g]=new Array(w.n).fill(2);return w.initCanvas(o),w.print(),w}return o(e,t),l(e,[{key:"initListeners",value:function(){this.listeners=[["click",this.click]]}},{key:"refresh",value:function(){this.grid=new Array(this.m);for(var t=0;t<this.m;t+=1)this.grid[t]=new Array(this.n).fill(2);this.hints.row.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),this.hints.column.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),this.solve()}},{key:"solve",value:function(){var t=this;this.isBusy||(this.print(),this.isBusy=!0,this.startTime=Date.now(),this.worker.onmessage=function(e){var n=e.data;if(t.canvas.nonogram!==t)return void t.worker.terminate();if(t.scanner=n.scanner,t.grid=n.grid,t.hints=n.hints,"update"!==n.type)if(t.isBusy=!1,"error"===n.type){t.isError=!0;var i=t.scanner,r=i.direction,o=i.i;t.handleError(new Error("Bad hints at "+r+" "+(o+1)))}else"finish"===n.type&&t.handleSuccess(Date.now()-t.startTime);t.print()},this.worker.postMessage({delay:this.delay,grid:this.grid,hints:this.hints}))}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printScanner(),this.printController()}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=o/10;t.width=o,t.height=o;var n=t.getContext("2d")||new CanvasRenderingContext2D;return n.translate(o/2,o/2),n.rotate(Math.PI),n.arc(0,0,o/2-e/2,Math.PI/2,Math.PI/3.9),n.lineWidth=e,n.strokeStyle=s,n.stroke(),n.beginPath(),n.moveTo((o/2+e)*Math.SQRT1_2,(o/2+e)*Math.SQRT1_2),n.lineTo((o/2-2*e)*Math.SQRT1_2,(o/2-2*e)*Math.SQRT1_2),n.lineTo((o/2-2*e)*Math.SQRT1_2,(o/2+e)*Math.SQRT1_2),n.closePath(),n.fillStyle=s,n.fill(),t}var e=this.ctx,n=this.canvas,i=n.width,r=n.height,o=Math.min(i,r)/4,s=this.theme.filledColor;e.clearRect(2*i/3-1,2*r/3-1,i/3+1,r/3+1),this.isBusy||(e.save(),e.translate(.7*i,.7*r),e.drawImage(t(),0,0),e.restore())}},{key:"printScanner",value:function(){if(this.scanner){var t=this.ctx,e=this.canvas,n=e.width,i=e.height,r=2*n/3/(this.n+1);t.save(),t.translate(r/2,r/2),t.fillStyle=this.isError?this.theme.wrongColor:this.theme.correctColor,t.globalAlpha=.5,"row"===this.scanner.direction?t.fillRect(0,r*this.scanner.i,n,r):"column"===this.scanner.direction&&t.fillRect(r*this.scanner.i,0,r,i),t.restore()}}}]),e}(s.a);e.a=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4),r=n(2),o=n(3);n.d(e,"Solver",function(){return i.a}),n.d(e,"Editor",function(){return r.a}),n.d(e,"Game",function(){return o.a})}])});