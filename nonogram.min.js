!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.nonogram=e():t.nonogram=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Play=e.Edit=e.Solve=void 0;var r=n(5),s=i(r),o=n(3),a=i(o),c=n(4),l=i(c);e.Solve=s.default,e.Edit=a.default,e.Play=l.default},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.FILLED=!0,e.EMPTY=!1,e.UNSET=void 0,e.TEMPORARILY_FILLED=1,e.TEMPORARILY_EMPTY=-1,e.INCONSTANT=0},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=n(1),o=function(){function t(){i(this,t)}return r(t,[{key:"getSingleLine",value:function(t,e){var n=[];if("row"===t)for(var i=0;i<this.n;i+=1)n[i]=this.grid[e][i];else if("col"===t)for(var r=0;r<this.m;r+=1)n[r]=this.grid[r][e];return n}},{key:"removeNonPositiveHints",value:function(){function t(t,e,n){n[e]=t.filter(Math.sign)}this.rowHints.forEach(t),this.colHints.forEach(t)}},{key:"getHints",value:function(t,e){return this[t+"Hints"][e].slice()}},{key:"calculateHints",value:function(t,e){var n=[],i=this.getSingleLine(t,e);return i.reduce(function(t,e){return e===s.FILLED&&n.push(t?n.pop()+1:1),e===s.FILLED},!1),n}},{key:"checkCorrectness",value:function(t,e){return this.calculateHints(t,e).toString()===this[t+"Hints"][e].toString()}},{key:"getLocation",value:function(t,e){var n=this.canvas.width,i=this.canvas.height,r=2*n/3,s=2*i/3,o=r/(this.n+1);return t<0||t>=n||e<0||e>=i?"outside":t>=0&&t<=r&&e>=0&&e<s?o/2<=t&&t<r-o/2&&o/2<=e&&e<s-o/2?"grid":"limbo":r<=t&&t<n&&s<=e&&e<i?"controller":"hints"}},{key:"print",value:function(){this.canvas&&(this.printGrid(),this.printHints(),this.printController())}},{key:"printGrid",value:function(){var t=this.canvas.getContext("2d"),e=this.canvas.width,n=this.canvas.height,i=2*e/3/(this.n+1);t.fillStyle=this.backgroundColor,t.fillRect(-1,-1,2*e/3+1,2*n/3+1),this.isMeshed&&!this.isMeshOnTop&&this.printMesh(),t.save(),t.translate(i/2,i/2);for(var r=0;r<this.m;r+=1)for(var s=0;s<this.n;s+=1)t.save(),t.translate(i*s,i*r),this.printCell(this.grid[r][s]),t.restore();t.restore(),this.isMeshed&&this.isMeshOnTop&&this.printMesh()}},{key:"printCell",value:function(t){var e=this.canvas.getContext("2d"),n=2*this.canvas.width/3/(this.n+1);switch(t){case s.UNSET:e.fillStyle=this.unsetColor,e.fillRect(.05*n,.05*n,.9*n,.9*n);break;case s.FILLED:e.fillStyle=this.filledColor,e.fillRect(.05*-n,.05*-n,1.1*n,1.1*n);break;default:return}}},{key:"printMesh",value:function(){var t=this.canvas.getContext("2d"),e=2*this.canvas.width/3/(this.n+1);t.save(),t.translate(e/2,e/2),t.beginPath();for(var n=1;n<this.m;n+=1)this.isBoldMeshOnly||(t.moveTo(0,n*e),t.lineTo(this.n*e,n*e)),n%this.boldMeshGap===0&&(t.moveTo(0,n*e),t.lineTo(this.n*e,n*e),this.isBoldMeshOnly||(t.moveTo(0,n*e-1),t.lineTo(this.n*e,n*e-1),t.moveTo(0,n*e+1),t.lineTo(this.n*e,n*e+1)));for(var i=1;i<this.n;i+=1)this.isBoldMeshOnly||(t.moveTo(i*e,0),t.lineTo(i*e,this.m*e)),i%this.boldMeshGap===0&&(t.moveTo(i*e,0),t.lineTo(i*e,this.m*e),this.isBoldMeshOnly||(t.moveTo(i*e-1,0),t.lineTo(i*e-1,this.m*e),t.moveTo(i*e+1,0),t.lineTo(i*e+1,this.m*e)));t.lineWidth=1,t.strokeStyle=this.meshColor,t.stroke(),t.restore()}},{key:"printHints",value:function(){function t(t,s,o){e.textAlign="center",e.textBaseline="middle",e.font=r+'pt "Courier New", Inconsolata, Consolas, monospace';var a=this[t+"Hints"][s];e.fillStyle=a.isCorrect?this.correctColor:this.wrongColor,e.globalAlpha=!a.isCorrect&&a.unchangedSinceLastScanned?.5:1,"row"===t?e.fillText(this.rowHints[s][o]||0,2*n/3+r*o,r*(s+.5),.8*r):"col"===t&&e.fillText(this.colHints[s][o]||0,r*(s+.5),2*i/3+r*o,.8*r)}var e=this.canvas.getContext("2d"),n=this.canvas.width,i=this.canvas.height,r=2*n/3/(this.n+1);e.fillStyle=this.backgroundColor,e.fillRect(2*n/3-1,-1,3*n+1,2*i/3+1),e.fillRect(-1,2*i/3-1,2*n/3+1,i/3+1),e.save(),e.translate(r/2,r/2);for(var s=0;s<this.m;s+=1){for(var o=0;o<this.rowHints[s].length;o+=1)t.call(this,"row",s,o);0===this.rowHints[s].length&&t.call(this,"row",s,0)}for(var a=0;a<this.n;a+=1){for(var c=0;c<this.colHints[a].length;c+=1)t.call(this,"col",a,c);0===this.colHints[a].length&&t.call(this,"col",a,0)}e.restore()}}]),t}();e.default=o,Object.assign(o.prototype,{backgroundColor:"#fff",filledColor:"#999",unsetColor:"#ccc",correctColor:"#0cf",wrongColor:"#f69",meshColor:"#999",isMeshed:!1,isBoldMeshOnly:!1,isMeshOnTop:!1,boldMeshGap:5})},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(2),l=i(c),h=n(1),u=function(t){function e(t,n,i,o){r(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(Object.assign(a,o),a.m=t,a.n=n,a.grid)a.grid.forEach(function(t){t.forEach(function(t,e,n){n[e]=t?h.FILLED:h.EMPTY})});else{a.grid=new Array(a.m);for(var c=0;c<a.m;c+=1){a.grid[c]=new Array(a.n);for(var l=0;l<a.n;l+=1)a.grid[c][l]=Math.random()<a.threshold?h.FILLED:h.EMPTY}}a.rowHints=new Array(t),a.colHints=new Array(n);for(var u=0;u<a.m;u+=1)a.rowHints[u]=a.calculateHints("row",u),a.rowHints[u].isCorrect=!0;for(var d=0;d<a.n;d+=1)a.colHints[d]=a.calculateHints("col",d),a.colHints[d].isCorrect=!0;return a.canvas=i instanceof HTMLCanvasElement?i:document.getElementById(i),!a.canvas||a.canvas.hasAttribute("occupied")?s(a):(a.canvas.width=a.width||a.canvas.clientWidth,a.canvas.height=a.canvas.width*(a.m+1)/(a.n+1),a.canvas.nonogram=a,a.canvas.addEventListener("mousedown",a.mousedown),a.canvas.addEventListener("mousemove",a.mousemove),a.canvas.addEventListener("mouseup",a.brushUp),a.canvas.addEventListener("mouseleave",a.brushUp),a.canvas.oncontextmenu=function(t){t.preventDefault()},a.draw={},a.print(),a.canvas.dispatchEvent(e.hintChange),a)}return o(e,t),a(e,[{key:"mousedown",value:function(t){var e=this.nonogram,n=t.clientX-this.getBoundingClientRect().left,i=t.clientY-this.getBoundingClientRect().top,r=2*this.clientWidth/3/(e.n+1),s=e.getLocation(n,i);if("controller"===s)e.refresh();else if("grid"===s){e.draw.firstI=Math.floor(i/r-.5),e.draw.firstJ=Math.floor(n/r-.5);var o=e.grid[e.draw.firstI][e.draw.firstJ];e.draw.brush=o===h.FILLED?h.EMPTY:h.FILLED,e.isPressed=!0,e.switchCell(e.draw.firstI,e.draw.firstJ),e.draw.lastI=e.draw.firstI,e.draw.lastJ=e.draw.firstJ}}},{key:"mousemove",value:function(t){var e=this.nonogram;if(e.isPressed){var n=t.clientX-this.getBoundingClientRect().left,i=t.clientY-this.getBoundingClientRect().top,r=2*this.clientWidth/3/(e.n+1);if("grid"===e.getLocation(n,i)){var s=Math.floor(i/r-.5),o=Math.floor(n/r-.5);s===e.draw.lastI&&o===e.draw.lastJ||(void 0===e.draw.direction&&(s===e.draw.firstI?e.draw.direction="row":o===e.draw.firstJ&&(e.draw.direction="col")),("row"===e.draw.direction&&s===e.draw.firstI||"col"===e.draw.direction&&o===e.draw.firstJ)&&(e.switchCell(s,o),e.draw.lastI=s,e.draw.lastJ=o))}}}},{key:"brushUp",value:function(){var t=this.nonogram;delete t.isPressed,t.draw={}}},{key:"switchCell",value:function(t,n){this.grid[t][n]=this.draw.brush,this.rowHints[t]=this.calculateHints("row",t),this.colHints[n]=this.calculateHints("col",n),this.print(),this.canvas.dispatchEvent(e.hintChange)}},{key:"refresh",value:function(){for(var t=0;t<this.m;t+=1)for(var n=0;n<this.n;n+=1)this.grid[t][n]=Math.random()<this.threshold?h.FILLED:h.EMPTY;for(var i=0;i<this.m;i+=1)this.rowHints[i]=this.calculateHints("row",i);for(var r=0;r<this.n;r+=1)this.colHints[r]=this.calculateHints("col",r);this.print(),this.canvas.dispatchEvent(e.hintChange)}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=r/10;t.width=r,t.height=r;var n=t.getContext("2d");return n.translate(r/2,r/2),n.arc(0,0,r/2-e/2,Math.PI/2,Math.PI/3.9),n.lineWidth=e,n.strokeStyle=s,n.stroke(),n.beginPath(),n.moveTo((r/2+e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),n.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2-2*e)*Math.SQRT1_2),n.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),n.closePath(),n.fillStyle=s,n.fill(),t}var e=this.canvas.getContext("2d"),n=this.canvas.width,i=this.canvas.height,r=Math.min(n,i)/4,s=this.filledColor;e.fillStyle=this.backgroundColor,e.fillRect(2*n/3-1,2*i/3-1,n/3+1,i/3+1),e.save(),e.translate(.7*n,.7*i),e.drawImage(t(),0,0),e.restore()}}],[{key:"hintChange",get:function(){return new Event("hintchange")}}]),e}(l.default);e.default=u,Object.assign(u.prototype,{filledColor:"#f69",correctColor:"#f69",threshold:.5})},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=n(2),l=i(c),h=n(1),u=function(t,e){return t.toString()===e.toString()},d=function(t){function e(t,n,i,o){r(this,e);var a=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));Object.assign(a,o),a.rowHints=t.slice(),a.colHints=n.slice(),a.removeNonPositiveHints(),a.m=t.length,a.n=n.length,a.grid=new Array(a.m);for(var c=0;c<a.m;c+=1)a.grid[c]=new Array(a.n).fill(h.UNSET);return a.rowHints.forEach(function(t,e){t.isCorrect=a.checkCorrectness("row",e)}),a.colHints.forEach(function(t,e){t.isCorrect=a.checkCorrectness("col",e)}),a.canvas=i instanceof HTMLCanvasElement?i:document.getElementById(i),!a.canvas||a.canvas.hasAttribute("occupied")?s(a):(a.canvas.width=a.width||a.canvas.clientWidth,a.canvas.height=a.canvas.width*(a.m+1)/(a.n+1),a.canvas.nonogram=a,a.canvas.addEventListener("mousedown",a.mousedown),a.canvas.addEventListener("mousemove",a.mousemove),a.canvas.addEventListener("mouseup",a.brushUp),a.canvas.addEventListener("mouseleave",a.brushUp),a.canvas.oncontextmenu=function(t){t.preventDefault()},a.brush=h.FILLED,a.draw={},a.print(),a)}return o(e,t),a(e,[{key:"mousedown",value:function(t){var e=this.nonogram,n=t.clientX-this.getBoundingClientRect().left,i=t.clientY-this.getBoundingClientRect().top,r=2*this.clientWidth/3/(e.n+1),s=e.getLocation(n,i);if("controller"===s)e.switchBrush();else if("grid"===s){e.draw.firstI=Math.floor(i/r-.5),e.draw.firstJ=Math.floor(n/r-.5),e.draw.inverted=2===t.button;var o=e.grid[e.draw.firstI][e.draw.firstJ],a=e.brush;e.draw.inverted&&(a=e.brush===h.FILLED?h.EMPTY:h.FILLED),o!==h.UNSET&&a!==o||(e.draw.mode=a===o?"empty":"filling",e.isPressed=!0,e.switchCell(e.draw.firstI,e.draw.firstJ)),e.draw.lastI=e.draw.firstI,e.draw.lastJ=e.draw.firstJ}}},{key:"mousemove",value:function(t){var e=this.nonogram;if(e.isPressed){var n=t.clientX-this.getBoundingClientRect().left,i=t.clientY-this.getBoundingClientRect().top,r=2*this.clientWidth/3/(e.n+1);if("grid"===e.getLocation(n,i)){var s=Math.floor(i/r-.5),o=Math.floor(n/r-.5);s===e.draw.lastI&&o===e.draw.lastJ||(void 0===e.draw.direction&&(s===e.draw.firstI?e.draw.direction="row":o===e.draw.firstJ&&(e.draw.direction="col")),("row"===e.draw.direction&&s===e.draw.firstI||"col"===e.draw.direction&&o===e.draw.firstJ)&&(e.switchCell(s,o),e.draw.lastI=s,e.draw.lastJ=o))}}}},{key:"switchBrush",value:function(){this.brush=this.brush===h.EMPTY?h.FILLED:h.EMPTY,this.printController()}},{key:"brushUp",value:function(){var t=this.nonogram;delete t.isPressed,t.draw={}}},{key:"switchCell",value:function(t,e){var n=this.brush;if(this.draw.inverted&&(n=this.brush===h.FILLED?h.EMPTY:h.FILLED),n===h.FILLED&&this.grid[t][e]!==h.EMPTY){this.grid[t][e]="filling"===this.draw.mode?h.FILLED:h.UNSET,this.rowHints[t].isCorrect=u(this.calculateHints("row",t),this.rowHints[t]),this.colHints[e].isCorrect=u(this.calculateHints("col",e),this.colHints[e]),this.print();var i=this.rowHints.every(function(t){return t.isCorrect})&&this.colHints.every(function(t){return t.isCorrect});i&&this.succeed()}else n===h.EMPTY&&this.grid[t][e]!==h.FILLED&&(this.grid[t][e]="filling"===this.draw.mode?h.EMPTY:h.UNSET,this.print())}},{key:"printCell",value:function(t){var e=this.canvas.getContext("2d"),n=2*this.canvas.width/3/(this.n+1);switch(t){case h.FILLED:e.fillStyle=this.filledColor,e.fillRect(.05*-n,.05*-n,1.1*n,1.1*n);break;case h.EMPTY:e.strokeStyle=this.emptyColor,e.lineWidth=n/15,e.beginPath(),e.moveTo(.3*n,.3*n),e.lineTo(.7*n,.7*n),e.moveTo(.3*n,.7*n),e.lineTo(.7*n,.3*n),e.stroke();break;default:return}}},{key:"printController",value:function(){function t(){n.save(),n.translate(a,0),n.fillStyle=this.meshColor,n.fillRect(0,0,o,o),n.fillStyle=this.filledColor,n.fillRect(c,c,l,l),n.restore()}function e(){n.save(),n.translate(0,a),n.fillStyle=this.meshColor,n.fillRect(0,0,o,o),n.fillStyle=this.backgroundColor,n.fillRect(c,c,l,l),n.strokeStyle="#f69",n.lineWidth=c,n.beginPath(),n.moveTo(.3*o,.3*o),n.lineTo(.7*o,.7*o),n.moveTo(.3*o,.7*o),n.lineTo(.7*o,.3*o),n.stroke(),n.restore()}var n=this.canvas.getContext("2d"),i=this.canvas.width,r=this.canvas.height,s=Math.min(i,r)/4,o=3*s/4,a=s/4,c=s/20,l=o-2*c;n.fillStyle=this.backgroundColor,n.fillRect(2*i/3-1,2*r/3-1,i/3+1,r/3+1),n.save(),n.translate(.7*i,.7*r),this.brush===h.FILLED?(e.call(this),t.call(this)):this.brush===h.EMPTY&&(t.call(this),e.call(this)),n.restore()}},{key:"succeed",value:function(){function t(){var t=2*a,e=t/10,n=document.createElement("canvas");n.width=t,n.height=t;var i=n.getContext("2d");return i.translate(t/3,5*t/6),i.rotate(-Math.PI/4),i.fillStyle="#0c6",i.fillRect(0,0,e,-t*Math.SQRT2/3),i.fillRect(0,0,t*Math.SQRT2*2/3,-e),n}function n(t){return 1+Math.pow(t-1,3)}function i(){r.putImageData(c,0,0),h+=.03,r.globalAlpha=n(h),r.fillStyle="#fff",r.fillRect(2*s/3,2*o/3,s/3,o/3),r.drawImage(l,.7*s-(1-n(h))*a/2,.7*o-(1-n(h))*a/2,(2-n(h))*a,(2-n(h))*a),h<=1?requestAnimationFrame(i.bind(this)):this.canvas.dispatchEvent(e.animationFinish)}if(this.canvas){this.canvas.dispatchEvent(e.success),this.canvas.removeEventListener("mousedown",this.mousedown),this.canvas.removeEventListener("mousemove",this.mousemove),this.canvas.removeEventListener("mouseup",this.brushUp),this.canvas.removeEventListener("mouseleave",this.brushUp);var r=this.canvas.getContext("2d"),s=this.canvas.width,o=this.canvas.height,a=Math.min(s,o)/4,c=r.getImageData(0,0,s,o),l=t(),h=0;i.call(this)}}}],[{key:"success",get:function(){return new Event("success")}},{key:"animationFinish",get:function(){return new Event("animationfinish")}}]),e}(l.default);e.default=d,Object.assign(d.prototype,{filledColor:"#0cf",emptyColor:"#f69",wrongColor:"#999",isMeshed:!0})},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(2),h=i(l),u=n(1),d=function(t){return t.reduce(function(t,e){return t+e},0)},f=function(t){function e(t,n,i,r){s(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));Object.assign(a,r),a.rowHints=t.slice(),a.colHints=n.slice(),a.removeNonPositiveHints(),a.m=t.length,a.n=n.length,a.grid=new Array(a.m);for(var c=0;c<a.m;c+=1)a.grid[c]=new Array(a.n);return a.rowHints.forEach(function(t){t.isCorrect=!1,t.unchangedSinceLastScanned=!1}),a.colHints.forEach(function(t){t.isCorrect=!1,t.unchangedSinceLastScanned=!1}),a.canvas=i instanceof HTMLCanvasElement?i:document.getElementById(i),!a.canvas||a.canvas.hasAttribute("occupied")?o(a):(a.canvas.width=a.width||a.canvas.clientWidth,a.canvas.height=a.canvas.width*(a.m+1)/(a.n+1),a.canvas.nonogram=a,a.canvas.addEventListener("click",a.click),a.canvas.oncontextmenu=function(t){t.preventDefault()},a.print(),a)}return a(e,t),c(e,[{key:"click",value:function(t){if(!this.hasAttribute("occupied")){var e=this.nonogram,n=2*this.clientWidth/3/(e.n+1),i=t.clientX-this.getBoundingClientRect().left,r=t.clientY-this.getBoundingClientRect().top,s=e.getLocation(i,r);if("grid"===s){if(e.scanner&&e.scanner.error)return;var o=Math.floor(r/n-.5),a=Math.floor(i/n-.5);e.grid[o][a]===u.UNSET&&(e.grid[o][a]=u.FILLED,e.rowHints[o].unchangedSinceLastScanned=!1,e.colHints[a].unchangedSinceLastScanned=!1,e.solve())}else"controller"===s&&e.refresh()}}},{key:"refresh",value:function(){if(!this.canvas.hasAttribute("occupied")){this.grid=new Array(this.m);for(var t=0;t<this.m;t+=1)this.grid[t]=new Array(this.n);this.rowHints.forEach(function(t){t.isCorrect=!1,t.unchangedSinceLastScanned=!1}),this.colHints.forEach(function(t){t.isCorrect=!1,t.unchangedSinceLastScanned=!1}),delete this.scanner,this.solve()}}},{key:"solve",value:function(){var t=this;return new Promise(function(e,n){if(t.canvas){if(t.canvas.hasAttribute("occupied"))return;t.canvas.setAttribute("occupied","")}else t.demoMode=!1;t.description="Solves a(n) "+t.m+"×"+t.n+" nonogram"+(t.demoMode?" in demo mode":""),console.time(t.description),t.scan(e,n)})}},{key:"scan",value:function(t,n){var i=this;if(this.updateScanner(t),void 0!==this.scanner)return this.demoMode&&this.print(),this.scanner.error=!0,this.solveSingleLine(),this.scanner.error?void(this.canvas&&(console.timeEnd(this.description),this.canvas.removeAttribute("occupied"),this.print(),this.canvas.dispatchEvent(e.error),n())):void(this.demoMode?setTimeout(function(){i.scan(t,n)},this.delay):this.scan(t,n))}},{key:"updateScanner",value:function(t){var n=void 0;do if(void 0===this.scanner?this.scanner={direction:"row",i:0}:(this.scanner.error=!1,this.scanner.i+=1,void 0===this[this.scanner.direction+"Hints"][this.scanner.i]&&(this.scanner.direction="row"===this.scanner.direction?"col":"row",this.scanner.i=0)),n=this[this.scanner.direction+"Hints"][this.scanner.i],this.rowHints.every(function(t){return t.unchangedSinceLastScanned})&&this.colHints.every(function(t){return t.unchangedSinceLastScanned}))return delete this.scanner,void(this.canvas&&(console.timeEnd(this.description),this.canvas.removeAttribute("occupied"),this.print(),this.canvas.dispatchEvent(e.success),t()));while(n.isCorrect||n.unchangedSinceLastScanned)}},{key:"solveSingleLine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scanner.direction,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scanner.i;this[t+"Hints"][e].unchangedSinceLastScanned=!0,this.line=this.getSingleLine(t,e);var n=this.line.every(function(t){return t!==u.UNSET});n||(this.hints=this.getHints(t,e),this.blanks=[],this.getAllSituations(this.line.length-d(this.hints)+1),this.setBackToGrid(t,e)),this.checkCorrectness(t,e)&&(this[t+"Hints"][e].isCorrect=!0,n&&(this.scanner.error=!1))}},{key:"getAllSituations",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n===this.hints.length&&(this.blanks=e.slice(0,this.hints.length),this.blanks[0]-=1,this.mergeSituation());for(var i=1;i<=t;i+=1)e[n]=i,this.getAllSituations(t-e[n],e,n+1)}},{key:"mergeSituation",value:function(){for(var t=this,e=[],n=0;n<this.hints.length;n+=1)e.push.apply(e,r(new Array(this.blanks[n]).fill(u.TEMPORARILY_EMPTY))),e.push.apply(e,r(new Array(this.hints[n]).fill(u.TEMPORARILY_FILLED)));e.push.apply(e,r(new Array(this.line.length-e.length).fill(u.TEMPORARILY_EMPTY)));var i=e.some(function(e,n){return e===u.TEMPORARILY_EMPTY&&t.line[n]===u.FILLED||e===u.TEMPORARILY_FILLED&&t.line[n]===u.EMPTY});i||(this.scanner.error=!1,e.forEach(function(e,n){e===u.TEMPORARILY_FILLED?t.line[n]===u.TEMPORARILY_EMPTY?t.line[n]=u.INCONSTANT:t.line[n]===u.UNSET&&(t.line[n]=u.TEMPORARILY_FILLED):e===u.TEMPORARILY_EMPTY&&(t.line[n]===u.TEMPORARILY_FILLED?t.line[n]=u.INCONSTANT:t.line[n]===u.UNSET&&(t.line[n]=u.TEMPORARILY_EMPTY))}))}},{key:"setBackToGrid",value:function(t,n){var i=this;"row"===t?this.line.forEach(function(t,r){e.cellValueMap.has(t)&&i.grid[n][r]!==e.cellValueMap.get(t)&&(i.grid[n][r]=e.cellValueMap.get(t),i.colHints[r].unchangedSinceLastScanned=!1)}):"col"===t&&this.line.forEach(function(t,r){e.cellValueMap.has(t)&&i.grid[r][n]!==e.cellValueMap.get(t)&&(i.grid[r][n]=e.cellValueMap.get(t),i.rowHints[r].unchangedSinceLastScanned=!1)})}},{key:"print",value:function(){this.canvas&&(this.printGrid(),this.printHints(),this.printController(),this.printScanner())}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=r/10;t.width=r,t.height=r;var n=t.getContext("2d");return n.translate(r/2,r/2),n.rotate(Math.PI),n.arc(0,0,r/2-e/2,Math.PI/2,Math.PI/3.9),n.lineWidth=e,n.strokeStyle=s,n.stroke(),n.beginPath(),n.moveTo((r/2+e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),n.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2-2*e)*Math.SQRT1_2),n.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),n.closePath(),n.fillStyle=s,n.fill(),t}var e=this.canvas.getContext("2d"),n=this.canvas.width,i=this.canvas.height,r=Math.min(n,i)/4,s=this.filledColor;e.fillStyle=this.backgroundColor,e.fillRect(2*n/3-1,2*i/3-1,n/3+1,i/3+1),this.canvas.hasAttribute("occupied")||(e.save(),e.translate(.7*n,.7*i),e.drawImage(t(),0,0),e.restore())}},{key:"printScanner",value:function(){if(void 0!==this.scanner){var t=this.canvas.getContext("2d"),e=this.canvas.width,n=this.canvas.height,i=2*e/3/(this.n+1);t.save(),t.translate(i/2,i/2),t.fillStyle=this.scanner.error?this.wrongColor:this.correctColor,t.globalAlpha=.5,"row"===this.scanner.direction?t.fillRect(0,i*this.scanner.i,e,i):"col"===this.scanner.direction&&t.fillRect(i*this.scanner.i,0,i,n),t.restore()}}}],[{key:"success",get:function(){return new Event("success")}},{key:"error",get:function(){return new Event("error")}},{key:"cellValueMap",get:function(){var t=new Map;return t.set(u.TEMPORARILY_FILLED,u.FILLED),t.set(u.TEMPORARILY_EMPTY,u.EMPTY),t.set(u.INCONSTANT,u.UNSET),t}}]),e}(h.default);e.default=f,Object.assign(f.prototype,{correctColor:"#999",demoMode:!0,delay:50})}])});