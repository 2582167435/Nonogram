!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.nonogram=e():t.nonogram=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=5)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={greyVeryLight:"#ccc",grey:"#555",greyVeryDark:"#111",blue:"#0ebeff",green:"#47cf73",violet:"#ae63e4",yellow:"#fcd000",red:"#ff3c41"}},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){return t.length===e.length&&t.every(function(t,i){return t===e[i]})}var s=function(){function t(t,e){var i=[],n=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,s=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw s}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(0),h=function(){function t(){n(this,t),this.theme={filledColor:a.default.grey,unsetColor:a.default.greyVeryLight,correctColor:a.default.green,wrongColor:a.default.red,meshColor:a.default.yellow,isMeshed:!1,isBoldMeshOnly:!1,isMeshOnTop:!1,boldMeshGap:5}}return o(t,[{key:"initCanvas",value:function(t){var e=this,i=t instanceof HTMLCanvasElement?t:document.getElementById(t);i instanceof HTMLCanvasElement||(i=document.createElement("canvas")),this.canvas=i,this.canvas.nonogram&&this.canvas.nonogram.listeners.forEach(function(t){var i=s(t,2),n=i[0],r=i[1];e.canvas.removeEventListener(n,r)}),this.canvas.nonogram=this,this.canvas.width=this.theme.width||this.canvas.clientWidth,this.canvas.height=this.canvas.width*(this.m+1)/(this.n+1),this.ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.initListeners(),this.listeners.forEach(function(t){var i=s(t,2),n=i[0],r=i[1];e.canvas.addEventListener(n,r)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}}},{key:"initListeners",value:function(){this.listeners=[]}},{key:"removeNonPositiveHints",value:function(){function t(t,e,i){i[e]=t.filter(function(t){return t>0})}this.hints.row.forEach(t),this.hints.column.forEach(t)}},{key:"getSingleLine",value:function(t,e){var i=[];if("row"===t)for(var n=0;n<this.n;n+=1)i[n]=this.grid[e][n];else if("column"===t)for(var r=0;r<this.m;r+=1)i[r]=this.grid[r][e];return i}},{key:"calculateHints",value:function(t,e){var i=[],n=this.getSingleLine(t,e);return n.reduce(function(t,e){return 1===e&&i.push(t?i.pop()+1:1),1===e},!1),i}},{key:"isLineCorrect",value:function(t,e){return r(this.calculateHints(t,e),this.hints[t][e])}},{key:"getLocation",value:function(t,e){var i=this.canvas.getBoundingClientRect(),n=i.width,r=i.height,s=2*n/3,o=2*r/3,a=s/(this.n+1);return t<0||t>=n||e<0||e>=r?"outside":t>=0&&t<=s&&e>=0&&e<o?a/2<=t&&t<s-a/2&&a/2<=e&&e<o-a/2?"grid":"limbo":s<=t&&t<n&&o<=e&&e<r?"controller":"hints"}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printController()}},{key:"printGrid",value:function(){var t=this.ctx,e=this.canvas,i=e.width,n=e.height,r=2*i/3/(this.n+1);t.clearRect(-1,-1,2*i/3+1,2*n/3+1),this.theme.isMeshed&&!this.theme.isMeshOnTop&&this.printMesh(),t.save(),t.translate(r/2,r/2);for(var s=0;s<this.m;s+=1)for(var o=0;o<this.n;o+=1)t.save(),t.translate(r*o,r*s),this.printCell(this.grid[s][o]),t.restore();t.restore(),this.theme.isMeshed&&this.theme.isMeshOnTop&&this.printMesh()}},{key:"printCell",value:function(t){var e=this.ctx,i=2*this.canvas.width/3/(this.n+1);switch(t){case 2:e.fillStyle=this.theme.unsetColor,e.fillRect(.05*i,.05*i,.9*i,.9*i);break;case 1:e.fillStyle=this.theme.filledColor,e.fillRect(.05*-i,.05*-i,1.1*i,1.1*i)}}},{key:"printMesh",value:function(){var t=this.ctx,e=2*this.canvas.width/3/(this.n+1);t.save(),t.translate(e/2,e/2),t.beginPath();for(var i=1;i<this.m;i+=1)this.theme.isBoldMeshOnly||(t.moveTo(0,i*e),t.lineTo(this.n*e,i*e)),i%this.theme.boldMeshGap===0&&(t.moveTo(0,i*e),t.lineTo(this.n*e,i*e),this.theme.isBoldMeshOnly||(t.moveTo(0,i*e-1),t.lineTo(this.n*e,i*e-1),t.moveTo(0,i*e+1),t.lineTo(this.n*e,i*e+1)));for(var n=1;n<this.n;n+=1)this.theme.isBoldMeshOnly||(t.moveTo(n*e,0),t.lineTo(n*e,this.m*e)),n%this.theme.boldMeshGap===0&&(t.moveTo(n*e,0),t.lineTo(n*e,this.m*e),this.theme.isBoldMeshOnly||(t.moveTo(n*e-1,0),t.lineTo(n*e-1,this.m*e),t.moveTo(n*e+1,0),t.lineTo(n*e+1,this.m*e)));t.lineWidth=1,t.strokeStyle=this.theme.meshColor,t.stroke(),t.restore()}},{key:"printHints",value:function(){var t=this.ctx,e=this.canvas,i=e.width,n=e.height,r=2*i/3/(this.n+1);t.clearRect(2*i/3-1,-1,3*i+1,2*n/3+1),t.clearRect(-1,2*n/3-1,2*i/3+1,n/3+1),t.save(),t.translate(r/2,r/2);for(var s=0;s<this.m;s+=1){for(var o=0;o<this.hints.row[s].length;o+=1)this.printSingleHint("row",s,o);0===this.hints.row[s].length&&this.printSingleHint("row",s,0)}for(var a=0;a<this.n;a+=1){for(var h=0;h<this.hints.column[a].length;h+=1)this.printSingleHint("column",a,h);0===this.hints.column[a].length&&this.printSingleHint("column",a,0)}t.restore()}},{key:"printSingleHint",value:function(t,e,i){var n=this.ctx,r=this.canvas,s=r.width,o=r.height,a=2*s/3/(this.n+1);n.textAlign="center",n.textBaseline="middle",n.font=a+'pt "Courier New", Inconsolata, Consolas, monospace';var h=this.hints[t][e];n.fillStyle=h.isCorrect?this.theme.correctColor:this.theme.wrongColor,n.globalAlpha=!h.isCorrect&&h.unchanged?.5:1,"row"===t?n.fillText(""+(this.hints.row[e][i]||0),2*s/3+a*i,a*(e+.5),.8*a):"column"===t&&n.fillText(""+(this.hints.column[e][i]||0),a*(e+.5),2*o/3+a*i,.8*a)}}]),t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=h},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),a=i(1),h=i(0),l=function(t){function e(t,i,s){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=o.theme,l=void 0===a?{}:a,c=o.grid,u=o.threshold,f=void 0===u?.5:u,d=o.onHintChange,v=void 0===d?function(){}:d;n(this,e);var m=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));m.theme.filledColor=h.default.violet,m.theme.correctColor=h.default.violet,Object.assign(m.theme,l),m.threshold=f,m.handleHintChange=v,m.m=t,m.n=i,m.grid=new Array(m.m);for(var w=0;w<m.m;w+=1){m.grid[w]=new Array(m.n);for(var g=0;g<m.n;g+=1)c?m.grid[w][g]=c[w][g]?1:0:m.grid[w][g]=Math.random()<m.threshold?1:0}m.hints={row:new Array(t),column:new Array(i)};for(var y=0;y<m.m;y+=1)m.hints.row[y]=m.calculateHints("row",y),m.hints.row[y].isCorrect=!0;for(var p=0;p<m.n;p+=1)m.hints.column[p]=m.calculateHints("column",p),m.hints.column[p].isCorrect=!0;return m.initCanvas(s),m.draw={},m.print(),m.handleHintChange(m.hints.row,m.hints.column),m}return s(e,t),o(e,[{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown.bind(this)],["mousemove",this.mousemove.bind(this)],["mouseup",this.brushUp.bind(this)],["mouseleave",this.brushUp.bind(this)]]}},{key:"mousedown",value:function(t){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,r=2*e.width/3/(this.n+1),s=this.getLocation(i,n);if("controller"===s)this.refresh();else if("grid"===s){this.draw.firstI=Math.floor(n/r-.5),this.draw.firstJ=Math.floor(i/r-.5);var o=this.grid[this.draw.firstI][this.draw.firstJ];this.draw.brush=1===o?0:1,this.isPressed=!0,this.switchCell(this.draw.firstI,this.draw.firstJ),this.draw.lastI=this.draw.firstI,this.draw.lastJ=this.draw.firstJ}}},{key:"mousemove",value:function(t){if(this.isPressed){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,r=2*e.width/3/(this.n+1);if("grid"===this.getLocation(i,n)){var s=Math.floor(n/r-.5),o=Math.floor(i/r-.5);s===this.draw.lastI&&o===this.draw.lastJ||(void 0===this.draw.direction&&(s===this.draw.firstI?this.draw.direction="row":o===this.draw.firstJ&&(this.draw.direction="column")),("row"===this.draw.direction&&s===this.draw.firstI||"column"===this.draw.direction&&o===this.draw.firstJ)&&(this.switchCell(s,o),this.draw.lastI=s,this.draw.lastJ=o))}}}},{key:"brushUp",value:function(){delete this.isPressed,this.draw={}}},{key:"switchCell",value:function(t,e){this.grid[t][e]=this.draw.brush||1,this.hints.row[t]=this.calculateHints("row",t),this.hints.row[t].isCorrect=!0,this.hints.column[e]=this.calculateHints("column",e),this.hints.column[e].isCorrect=!0,this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"refresh",value:function(){for(var t=0;t<this.m;t+=1)for(var e=0;e<this.n;e+=1)this.grid[t][e]=Math.random()<this.threshold?1:0;for(var i=0;i<this.m;i+=1)this.hints.row[i]=this.calculateHints("row",i),this.hints.row[i].isCorrect=!0;for(var n=0;n<this.n;n+=1)this.hints.column[n]=this.calculateHints("column",n),this.hints.column[n].isCorrect=!0;this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=s/10;t.width=s,t.height=s;var i=t.getContext("2d")||new CanvasRenderingContext2D;return i.translate(s/2,s/2),i.arc(0,0,s/2-e/2,Math.PI/2,Math.PI/3.9),i.lineWidth=e,i.strokeStyle=o,i.stroke(),i.beginPath(),i.moveTo((s/2+e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),i.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2-2*e)*Math.SQRT1_2),i.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),i.closePath(),i.fillStyle=o,i.fill(),t}var e=this.ctx,i=this.canvas,n=i.width,r=i.height,s=Math.min(n,r)/4,o=this.theme.filledColor;e.clearRect(2*n/3-1,2*r/3-1,n/3+1,r/3+1),e.save(),e.translate(.7*n,.7*r),e.drawImage(t(),0,0),e.restore()}}]),e}(a.default);Object.defineProperty(e,"__esModule",{value:!0}),e.default=l},function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=function(){function t(t,e){var i=[],n=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,s=t}finally{try{!n&&a.return&&a.return()}finally{if(r)throw s}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=i(1),l=i(0),c=function(t){function e(t,i,s){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=o.theme,h=void 0===a?{}:a,c=o.onSuccess,u=void 0===c?function(){}:c,f=o.onAnimationEnd,d=void 0===f?function(){}:f;n(this,e);var v=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));v.theme.filledColor=l.default.blue,v.theme.wrongColor=l.default.grey,v.theme.isMeshed=!0,Object.assign(v.theme,h),v.handleSuccess=u,v.handleAnimationEnd=d,v.hints={row:t.slice(),column:i.slice()},v.removeNonPositiveHints(),v.m=v.hints.row.length,v.n=v.hints.column.length,v.grid=new Array(v.m);for(var m=0;m<v.m;m+=1)v.grid[m]=new Array(v.n).fill(2);return v.hints.row.forEach(function(t,e){t.isCorrect=v.isLineCorrect("row",e)}),v.hints.column.forEach(function(t,e){t.isCorrect=v.isLineCorrect("column",e)}),v.initCanvas(s),v.brush=1,v.draw={},v.print(),v}return s(e,t),a(e,[{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown.bind(this)],["mousemove",this.mousemove.bind(this)],["mouseup",this.brushUp.bind(this)],["mouseleave",this.brushUp.bind(this)]]}},{key:"mousedown",value:function(t){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,r=2*e.width/3/(this.n+1),s=this.getLocation(i,n);if("controller"===s)this.switchBrush();else if("grid"===s){this.draw.firstI=Math.floor(n/r-.5),this.draw.firstJ=Math.floor(i/r-.5),this.draw.inverted=2===t.button;var o=this.grid[this.draw.firstI][this.draw.firstJ],a=this.brush;this.draw.inverted&&(a=1===this.brush?0:1),2!==o&&a!==o||(this.draw.mode=a===o?"empty":"filling",this.isPressed=!0,this.switchCell(this.draw.firstI,this.draw.firstJ)),this.draw.lastI=this.draw.firstI,this.draw.lastJ=this.draw.firstJ}}},{key:"mousemove",value:function(t){if(this.isPressed){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,r=2*e.width/3/(this.n+1);if("grid"===this.getLocation(i,n)){var s=Math.floor(n/r-.5),o=Math.floor(i/r-.5);s===this.draw.lastI&&o===this.draw.lastJ||(void 0===this.draw.direction&&(s===this.draw.firstI?this.draw.direction="row":o===this.draw.firstJ&&(this.draw.direction="column")),("row"===this.draw.direction&&s===this.draw.firstI||"column"===this.draw.direction&&o===this.draw.firstJ)&&(this.switchCell(s,o),this.draw.lastI=s,this.draw.lastJ=o))}}}},{key:"switchBrush",value:function(){this.brush=0===this.brush?1:0,this.printController()}},{key:"brushUp",value:function(){delete this.isPressed,this.draw={}}},{key:"switchCell",value:function(t,e){var i=this.brush;if(this.draw.inverted&&(i=1===this.brush?0:1),1===i&&0!==this.grid[t][e]){this.grid[t][e]="filling"===this.draw.mode?1:2,this.hints.row[t].isCorrect=this.isLineCorrect("row",t),this.hints.column[e].isCorrect=this.isLineCorrect("column",e),this.print();var n=this.hints.row.every(function(t){return!!t.isCorrect})&&this.hints.column.every(function(t){return!!t.isCorrect});n&&this.succeed()}else 0===i&&1!==this.grid[t][e]&&(this.grid[t][e]="filling"===this.draw.mode?0:2,this.print())}},{key:"printCell",value:function(t){var e=this.ctx,i=2*this.canvas.width/3/(this.n+1);switch(t){case 1:e.fillStyle=this.theme.filledColor,e.fillRect(.05*-i,.05*-i,1.1*i,1.1*i);break;case 0:e.strokeStyle=l.default.red,e.lineWidth=i/15,e.beginPath(),e.moveTo(.3*i,.3*i),e.lineTo(.7*i,.7*i),e.moveTo(.3*i,.7*i),e.lineTo(.7*i,.3*i),e.stroke()}}},{key:"printController",value:function(){function t(){i.save(),i.translate(h,0),i.fillStyle=this.theme.meshColor,i.fillRect(0,0,a,a),i.fillStyle=this.theme.filledColor,i.fillRect(c,c,u,u),i.restore()}function e(){i.save(),i.translate(0,h),i.fillStyle=this.theme.meshColor,i.fillRect(0,0,a,a),i.clearRect(c,c,u,u),i.strokeStyle=l.default.red,i.lineWidth=c,i.beginPath(),i.moveTo(.3*a,.3*a),i.lineTo(.7*a,.7*a),i.moveTo(.3*a,.7*a),i.lineTo(.7*a,.3*a),i.stroke(),i.restore()}var i=this.ctx,n=this.canvas,r=n.width,s=n.height,o=Math.min(r,s)/4,a=3*o/4,h=o/4,c=o/20,u=a-2*c;i.clearRect(2*r/3-1,2*s/3-1,r/3+1,s/3+1),i.save(),i.translate(.7*r,.7*s),1===this.brush?(e.call(this),t.call(this)):0===this.brush&&(t.call(this),e.call(this)),i.restore()}},{key:"succeed",value:function(){function t(){var t=2*c,e=t/10,i=document.createElement("canvas");i.width=t,i.height=t;var n=i.getContext("2d")||new CanvasRenderingContext2D;return n.translate(t/3,5*t/6),n.rotate(-Math.PI/4),n.fillStyle=l.default.green,n.fillRect(0,0,e,-t*Math.SQRT2/3),n.fillRect(0,0,t*Math.SQRT2*2/3,-e),i}function e(t){return 1+Math.pow(t-1,3)}function i(){r.putImageData(u,0,0),d+=.03,r.globalAlpha=e(d),r.clearRect(2*a/3,2*h/3,a/3,h/3),r.drawImage(f,.7*a-(1-e(d))*c/2,.7*h-(1-e(d))*c/2,(2-e(d))*c,(2-e(d))*c),d<=1?requestAnimationFrame(i.bind(this)):this.handleAnimationEnd()}var n=this;this.handleSuccess(),this.listeners.forEach(function(t){var e=o(t,2),i=e[0],r=e[1];n.canvas.removeEventListener(i,r)});var r=this.ctx,s=this.canvas,a=s.width,h=s.height,c=Math.min(a,h)/4,u=r.getImageData(0,0,a,h),f=t(),d=0;i.call(this)}}]),e}(h.default);Object.defineProperty(e,"__esModule",{value:!0}),e.default=c},function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),h=i(1),l=i(0),c=function(t){return t.reduce(function(t,e){return t+e},0)},u=new Map;u.set(3,1),u.set(4,0),u.set(5,2);var f=function(t){function e(t,i,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=o.theme,h=void 0===a?{}:a,c=o.demoMode,u=void 0===c||c,f=o.delay,d=void 0===f?50:f,v=o.onSuccess,m=void 0===v?function(){}:v,w=o.onError,g=void 0===w?function(){}:w;r(this,e);var y=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));y.theme.filledColor=l.default.green,y.theme.correctColor=l.default.green,y.theme.wrongColor=l.default.yellow,Object.assign(y.theme,h),y.demoMode=u,y.delay=d,y.handleSuccess=m,y.handleError=g,y.hints={row:t.slice(),column:i.slice()},y.removeNonPositiveHints(),y.m=y.hints.row.length,y.n=y.hints.column.length,y.grid=new Array(y.m);for(var p=0;p<y.m;p+=1)y.grid[p]=new Array(y.n).fill(2);return y.hints.row.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),y.hints.column.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),y.scan=y.scan.bind(y),y.scanner={disabled:!0,direction:"row",i:0,line:[],hints:[],error:!1},y.initCanvas(n),y.print(),y}return o(e,t),a(e,[{key:"initListeners",value:function(){this.listeners=[["click",this.click.bind(this)]]}},{key:"click",value:function(t){if(!this.isBusy){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,r=2*e.width/3/(this.n+1),s=this.getLocation(i,n);if("grid"===s){if(this.scanner&&this.scanner.error)return;var o=Math.floor(n/r-.5),a=Math.floor(i/r-.5);2===this.grid[o][a]&&(this.grid[o][a]=1,this.hints.row[o].unchanged=!1,this.hints.column[a].unchanged=!1,this.solve())}else"controller"===s&&this.refresh()}}},{key:"refresh",value:function(){if(!this.isBusy){this.grid=new Array(this.m);for(var t=0;t<this.m;t+=1)this.grid[t]=new Array(this.n);this.hints.row.forEach(function(t){t.isCorrect=!1,t.unchanged=!1,delete t.possibleBlanks}),this.hints.column.forEach(function(t){t.isCorrect=!1,t.unchanged=!1,delete t.possibleBlanks}),this.scanner.disabled=!0,this.solve()}}},{key:"solve",value:function(){this.isBusy||(this.isBusy=!0,this.startTime=Date.now(),this.scan())}},{key:"scan",value:function(){if(this.canvas.nonogram===this&&(this.updateScanner(),!this.scanner.disabled))return this.demoMode&&this.print(),this.scanner.error=!0,this.solveSingleLine(),this.scanner.error?(this.isBusy=!1,this.print(),void this.handleError(new Error("Bad hints at "+this.scanner.direction+" "+(this.scanner.i+1)))):void(this.demoMode?setTimeout(this.scan,this.delay):this.scan())}},{key:"updateScanner",value:function(){var t=void 0;do if(this.scanner.disabled?this.scanner={disabled:!1,direction:"row",i:0,line:[],hints:[],error:!1}:(this.scanner.error=!1,this.scanner.i+=1,void 0===this.hints[this.scanner.direction][this.scanner.i]&&(this.scanner.direction="row"===this.scanner.direction?"column":"row",this.scanner.i=0)),t=this.hints[this.scanner.direction][this.scanner.i],this.hints.row.every(function(t){return!!t.unchanged})&&this.hints.column.every(function(t){return!!t.unchanged}))return this.scanner.disabled=!0,this.isBusy=!1,this.print(),void this.handleSuccess(Date.now()-this.startTime);while(t.isCorrect||t.unchanged)}},{key:"solveSingleLine",value:function(){this.scanner=this.scanner;var t=this.scanner,e=t.direction,i=t.i;this.scanner.hints=this.hints[e][i],this.scanner.hints.unchanged=!0,this.scanner.line=this.getSingleLine(e,i);var n=this.scanner.line.every(function(t){return 2!==t});n||(void 0===this.scanner.hints.possibleBlanks&&(this.scanner.hints.possibleBlanks=[],this.findAllSituations(this.scanner.line.length-c(this.scanner.hints)+1)),this.mergeSituation(),this.setBackToGrid()),this.isLineCorrect(e,i)&&(this.hints[e][i].isCorrect=!0,n&&(this.scanner.error=!1))}},{key:"findAllSituations",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(i===this.scanner.hints.length){var n=e.slice(0,this.scanner.hints.length);n[0]-=1,this.scanner.hints.possibleBlanks&&this.scanner.hints.possibleBlanks.push(n)}for(var r=1;r<=t;r+=1)e[i]=r,this.findAllSituations(t-e[i],e,i+1)}},{key:"mergeSituation",value:function(){var t=this,e=this.scanner.hints.possibleBlanks||[];e.forEach(function(i,r){for(var s=[],o=0;o<t.scanner.hints.length;o+=1)s.push.apply(s,n(new Array(i[o]).fill(4))),s.push.apply(s,n(new Array(t.scanner.hints[o]).fill(3)));s.push.apply(s,n(new Array(t.scanner.line.length-s.length).fill(4)));var a=s.some(function(e,i){return 4===e&&1===t.scanner.line[i]||3===e&&0===t.scanner.line[i]});return a?void delete e[r]:(t.scanner.error=!1,void s.forEach(function(e,i){3===e?4===t.scanner.line[i]?t.scanner.line[i]=5:2===t.scanner.line[i]&&(t.scanner.line[i]=3):4===e&&(3===t.scanner.line[i]?t.scanner.line[i]=5:2===t.scanner.line[i]&&(t.scanner.line[i]=4))}))}),this.scanner.hints.possibleBlanks=e.filter(function(t){return null!==t})}},{key:"setBackToGrid",value:function(){var t=this,e=this.scanner,i=e.direction,n=e.i;"row"===i?this.scanner.line.forEach(function(e,i){u.has(e)&&t.grid[n][i]!==u.get(e)&&(t.grid[n][i]=u.get(e),t.hints.column[i].unchanged=!1)}):"column"===i&&this.scanner.line.forEach(function(e,i){u.has(e)&&t.grid[i][n]!==u.get(e)&&(t.grid[i][n]=u.get(e),t.hints.row[i].unchanged=!1)})}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printController(),this.printScanner()}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=s/10;t.width=s,t.height=s;var i=t.getContext("2d")||new CanvasRenderingContext2D;return i.translate(s/2,s/2),i.rotate(Math.PI),i.arc(0,0,s/2-e/2,Math.PI/2,Math.PI/3.9),i.lineWidth=e,i.strokeStyle=o,i.stroke(),i.beginPath(),i.moveTo((s/2+e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),i.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2-2*e)*Math.SQRT1_2),i.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),i.closePath(),i.fillStyle=o,i.fill(),t}var e=this.ctx,i=this.canvas,n=i.width,r=i.height,s=Math.min(n,r)/4,o=this.theme.filledColor;e.clearRect(2*n/3-1,2*r/3-1,n/3+1,r/3+1),this.isBusy||(e.save(),e.translate(.7*n,.7*r),e.drawImage(t(),0,0),e.restore())}},{key:"printScanner",value:function(){if(!this.scanner.disabled){var t=this.ctx,e=this.canvas,i=e.width,n=e.height,r=2*i/3/(this.n+1);t.save(),t.translate(r/2,r/2),t.fillStyle=this.scanner.error?this.theme.wrongColor:this.theme.correctColor,t.globalAlpha=.5,"row"===this.scanner.direction?t.fillRect(0,r*this.scanner.i,i,r):"column"===this.scanner.direction&&t.fillRect(r*this.scanner.i,0,r,n),t.restore()}}}]),e}(h.default);Object.defineProperty(e,"__esModule",{value:!0}),e.default=f},function(t,e,i){"use strict";var n=i(4);e.Solver=n.default;var r=i(2);e.Editor=r.default;var s=i(3);e.Game=s.default}])});