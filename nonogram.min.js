!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.nonogram=e():t.nonogram=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=5)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={greyVeryLight:"#ccc",grey:"#555",greyVeryDark:"#111",blue:"#0ebeff",green:"#47cf73",violet:"#ae63e4",yellow:"#fcd000",red:"#ff3c41"}},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){return t.length===e.length&&t.every(function(t,n){return t===e[n]})}var s=function(){function t(t,e){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,s=t}finally{try{!i&&a.return&&a.return()}finally{if(r)throw s}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(0),l=function(){function t(){i(this,t),this.theme={filledColor:a.default.grey,unsetColor:a.default.greyVeryLight,correctColor:a.default.green,wrongColor:a.default.red,meshColor:a.default.yellow,isMeshed:!1,isBoldMeshOnly:!1,isMeshOnTop:!1,boldMeshGap:5}}return o(t,[{key:"initCanvas",value:function(t){var e=this,n=t instanceof HTMLCanvasElement?t:document.getElementById(t);n instanceof HTMLCanvasElement||(n=document.createElement("canvas")),this.canvas=n,this.canvas.nonogram&&this.canvas.nonogram.listeners.forEach(function(t){var n=s(t,2),i=n[0],r=n[1];e.canvas.removeEventListener(i,r)}),this.canvas.nonogram=this,this.canvas.width=this.theme.width||this.canvas.clientWidth,this.canvas.height=this.canvas.width*(this.m+1)/(this.n+1),this.ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.initListeners(),this.listeners.forEach(function(t){var n=s(t,2),i=n[0],r=n[1];e.canvas.addEventListener(i,r)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}}},{key:"initListeners",value:function(){this.listeners=[]}},{key:"removeNonPositiveHints",value:function(){function t(t,e,n){n[e]=t.filter(function(t){return t>0})}this.hints.row.forEach(t),this.hints.column.forEach(t)}},{key:"getSingleLine",value:function(t,e){var n=[];if("row"===t)for(var i=0;i<this.n;i+=1)n[i]=this.grid[e][i];else if("column"===t)for(var r=0;r<this.m;r+=1)n[r]=this.grid[r][e];return n}},{key:"calculateHints",value:function(t,e){var n=[],i=this.getSingleLine(t,e);return i.reduce(function(t,e){return 1===e&&n.push(t?n.pop()+1:1),1===e},!1),n}},{key:"isLineCorrect",value:function(t,e){return r(this.calculateHints(t,e),this.hints[t][e])}},{key:"getLocation",value:function(t,e){var n=this.canvas.getBoundingClientRect(),i=n.width,r=n.height,s=2*i/3,o=2*r/3,a=s/(this.n+1);return t<0||t>=i||e<0||e>=r?"outside":t>=0&&t<=s&&e>=0&&e<o?a/2<=t&&t<s-a/2&&a/2<=e&&e<o-a/2?"grid":"limbo":s<=t&&t<i&&o<=e&&e<r?"controller":"hints"}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printController()}},{key:"printGrid",value:function(){var t=this.ctx,e=this.canvas,n=e.width,i=e.height,r=2*n/3/(this.n+1);t.clearRect(-1,-1,2*n/3+1,2*i/3+1),this.theme.isMeshed&&!this.theme.isMeshOnTop&&this.printMesh(),t.save(),t.translate(r/2,r/2);for(var s=0;s<this.m;s+=1)for(var o=0;o<this.n;o+=1)t.save(),t.translate(r*o,r*s),this.printCell(this.grid[s][o]),t.restore();t.restore(),this.theme.isMeshed&&this.theme.isMeshOnTop&&this.printMesh()}},{key:"printCell",value:function(t){var e=this.ctx,n=2*this.canvas.width/3/(this.n+1);switch(t){case 2:e.fillStyle=this.theme.unsetColor,e.fillRect(.05*n,.05*n,.9*n,.9*n);break;case 1:e.fillStyle=this.theme.filledColor,e.fillRect(.05*-n,.05*-n,1.1*n,1.1*n)}}},{key:"printMesh",value:function(){var t=this.ctx,e=2*this.canvas.width/3/(this.n+1);t.save(),t.translate(e/2,e/2),t.beginPath();for(var n=1;n<this.m;n+=1)this.theme.isBoldMeshOnly||(t.moveTo(0,n*e),t.lineTo(this.n*e,n*e)),n%this.theme.boldMeshGap===0&&(t.moveTo(0,n*e),t.lineTo(this.n*e,n*e),this.theme.isBoldMeshOnly||(t.moveTo(0,n*e-1),t.lineTo(this.n*e,n*e-1),t.moveTo(0,n*e+1),t.lineTo(this.n*e,n*e+1)));for(var i=1;i<this.n;i+=1)this.theme.isBoldMeshOnly||(t.moveTo(i*e,0),t.lineTo(i*e,this.m*e)),i%this.theme.boldMeshGap===0&&(t.moveTo(i*e,0),t.lineTo(i*e,this.m*e),this.theme.isBoldMeshOnly||(t.moveTo(i*e-1,0),t.lineTo(i*e-1,this.m*e),t.moveTo(i*e+1,0),t.lineTo(i*e+1,this.m*e)));t.lineWidth=1,t.strokeStyle=this.theme.meshColor,t.stroke(),t.restore()}},{key:"printHints",value:function(){var t=this.ctx,e=this.canvas,n=e.width,i=e.height,r=2*n/3/(this.n+1);t.clearRect(2*n/3-1,-1,3*n+1,2*i/3+1),t.clearRect(-1,2*i/3-1,2*n/3+1,i/3+1),t.save(),t.translate(r/2,r/2);for(var s=0;s<this.m;s+=1){for(var o=0;o<this.hints.row[s].length;o+=1)this.printSingleHint("row",s,o);0===this.hints.row[s].length&&this.printSingleHint("row",s,0)}for(var a=0;a<this.n;a+=1){for(var l=0;l<this.hints.column[a].length;l+=1)this.printSingleHint("column",a,l);0===this.hints.column[a].length&&this.printSingleHint("column",a,0)}t.restore()}},{key:"printSingleHint",value:function(t,e,n){var i=this.ctx,r=this.canvas,s=r.width,o=r.height,a=2*s/3/(this.n+1);i.textAlign="center",i.textBaseline="middle",i.font=a+'pt "Courier New", Inconsolata, Consolas, monospace';var l=this.hints[t][e];i.fillStyle=l.isCorrect?this.theme.correctColor:this.theme.wrongColor,i.globalAlpha=!l.isCorrect&&l.unchanged?.5:1,"row"===t?i.fillText(""+(this.hints.row[e][n]||0),2*s/3+a*n,a*(e+.5),.8*a):"column"===t&&i.fillText(""+(this.hints.column[e][n]||0),a*(e+.5),2*o/3+a*n,.8*a)}}]),t}();Object.defineProperty(e,"__esModule",{value:!0}),e.default=l},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=n(1),l=n(0),h=function(t){function e(t,n,s){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=o.theme,h=void 0===a?{}:a,c=o.grid,u=o.threshold,f=void 0===u?.5:u,d=o.onHintChange,v=void 0===d?function(){}:d;i(this,e);var m=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));m.mousedown=function(t){var e=m.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(m.n+1),s=m.getLocation(n,i);if("controller"===s)m.refresh();else if("grid"===s){m.draw.firstI=Math.floor(i/r-.5),m.draw.firstJ=Math.floor(n/r-.5);var o=m.grid[m.draw.firstI][m.draw.firstJ];m.draw.brush=1===o?0:1,m.isPressed=!0,m.paintCell(m.draw.firstI,m.draw.firstJ),m.draw.lastI=m.draw.firstI,m.draw.lastJ=m.draw.firstJ}},m.mousemove=function(t){if(m.isPressed){var e=m.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(m.n+1);if("grid"===m.getLocation(n,i)){var s=Math.floor(i/r-.5),o=Math.floor(n/r-.5);s===m.draw.lastI&&o===m.draw.lastJ||(void 0===m.draw.direction&&(s===m.draw.firstI?m.draw.direction="row":o===m.draw.firstJ&&(m.draw.direction="column")),("row"===m.draw.direction&&s===m.draw.firstI||"column"===m.draw.direction&&o===m.draw.firstJ)&&(m.paintCell(s,o),m.draw.lastI=s,m.draw.lastJ=o))}}},m.brushUp=function(){delete m.isPressed,m.draw={}},m.theme.filledColor=l.default.violet,m.theme.correctColor=l.default.violet,Object.assign(m.theme,h),m.threshold=f,m.handleHintChange=v,m.m=t,m.n=n,m.grid=new Array(m.m);for(var w=0;w<m.m;w+=1){m.grid[w]=new Array(m.n);for(var g=0;g<m.n;g+=1)c?m.grid[w][g]=c[w][g]?1:0:m.grid[w][g]=Math.random()<m.threshold?1:0}m.hints={row:new Array(t),column:new Array(n)};for(var p=0;p<m.m;p+=1)m.hints.row[p]=m.calculateHints("row",p),m.hints.row[p].isCorrect=!0;for(var y=0;y<m.n;y+=1)m.hints.column[y]=m.calculateHints("column",y),m.hints.column[y].isCorrect=!0;return m.initCanvas(s),m.draw={},m.print(),m.handleHintChange(m.hints.row,m.hints.column),m}return s(e,t),o(e,[{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown],["mousemove",this.mousemove],["mouseup",this.brushUp],["mouseleave",this.brushUp]]}},{key:"paintCell",value:function(t,e){this.grid[t][e]=this.draw.brush,this.hints.row[t]=this.calculateHints("row",t),this.hints.row[t].isCorrect=!0,this.hints.column[e]=this.calculateHints("column",e),this.hints.column[e].isCorrect=!0,this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"refresh",value:function(){for(var t=0;t<this.m;t+=1)for(var e=0;e<this.n;e+=1)this.grid[t][e]=Math.random()<this.threshold?1:0;for(var n=0;n<this.m;n+=1)this.hints.row[n]=this.calculateHints("row",n),this.hints.row[n].isCorrect=!0;for(var i=0;i<this.n;i+=1)this.hints.column[i]=this.calculateHints("column",i),this.hints.column[i].isCorrect=!0;this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=s/10;t.width=s,t.height=s;var n=t.getContext("2d")||new CanvasRenderingContext2D;return n.translate(s/2,s/2),n.arc(0,0,s/2-e/2,Math.PI/2,Math.PI/3.9),n.lineWidth=e,n.strokeStyle=o,n.stroke(),n.beginPath(),n.moveTo((s/2+e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),n.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2-2*e)*Math.SQRT1_2),n.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),n.closePath(),n.fillStyle=o,n.fill(),t}var e=this.ctx,n=this.canvas,i=n.width,r=n.height,s=Math.min(i,r)/4,o=this.theme.filledColor;e.clearRect(2*i/3-1,2*r/3-1,i/3+1,r/3+1),e.save(),e.translate(.7*i,.7*r),e.drawImage(t(),0,0),e.restore()}}]),e}(a.default);Object.defineProperty(e,"__esModule",{value:!0}),e.default=h},function(t,e,n){"use strict";function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var o=function(){function t(t,e){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,s=t}finally{try{!i&&a.return&&a.return()}finally{if(r)throw s}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(1),h=n(0),c=function(t){function e(t,n,s){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=o.theme,l=void 0===a?{}:a,c=o.onSuccess,u=void 0===c?function(){}:c,f=o.onAnimationEnd,d=void 0===f?function(){}:f;i(this,e);var v=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));v.mousedown=function(t){var e=v.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(v.n+1),s=v.getLocation(n,i);if("controller"===s)v.switchBrush();else if("grid"===s){v.draw.firstI=Math.floor(i/r-.5),v.draw.firstJ=Math.floor(n/r-.5),v.draw.inverted=2===t.button;var o=v.grid[v.draw.firstI][v.draw.firstJ],a=v.brush;v.draw.inverted&&(a=1===v.brush?0:1),2!==o&&a!==o||(v.draw.mode=a===o?"empty":"filling",v.isPressed=!0,v.switchCell(v.draw.firstI,v.draw.firstJ)),v.draw.lastI=v.draw.firstI,v.draw.lastJ=v.draw.firstJ}},v.mousemove=function(t){if(v.isPressed){var e=v.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(v.n+1);if("grid"===v.getLocation(n,i)){var s=Math.floor(i/r-.5),o=Math.floor(n/r-.5);s===v.draw.lastI&&o===v.draw.lastJ||(void 0===v.draw.direction&&(s===v.draw.firstI?v.draw.direction="row":o===v.draw.firstJ&&(v.draw.direction="column")),("row"===v.draw.direction&&s===v.draw.firstI||"column"===v.draw.direction&&o===v.draw.firstJ)&&(v.switchCell(s,o),v.draw.lastI=s,v.draw.lastJ=o))}}},v.brushUp=function(){delete v.isPressed,v.draw={}},v.theme.filledColor=h.default.blue,v.theme.wrongColor=h.default.grey,v.theme.isMeshed=!0,Object.assign(v.theme,l),v.handleSuccess=u,v.handleAnimationEnd=d,v.hints={row:t.slice(),column:n.slice()},v.removeNonPositiveHints(),v.m=v.hints.row.length,v.n=v.hints.column.length,v.grid=new Array(v.m);for(var m=0;m<v.m;m+=1)v.grid[m]=new Array(v.n).fill(2);return v.hints.row.forEach(function(t,e){t.isCorrect=v.isLineCorrect("row",e)}),v.hints.column.forEach(function(t,e){t.isCorrect=v.isLineCorrect("column",e)}),v.initCanvas(s),v.brush=1,v.draw={},v.print(),v}return s(e,t),a(e,[{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown],["mousemove",this.mousemove],["mouseup",this.brushUp],["mouseleave",this.brushUp]]}},{key:"switchBrush",value:function(){this.brush=0===this.brush?1:0,this.printController()}},{key:"switchCell",value:function(t,e){var n=this.brush;if(this.draw.inverted&&(n=1===this.brush?0:1),1===n&&0!==this.grid[t][e]){this.grid[t][e]="filling"===this.draw.mode?1:2,this.hints.row[t].isCorrect=this.isLineCorrect("row",t),this.hints.column[e].isCorrect=this.isLineCorrect("column",e),this.print();var i=this.hints.row.every(function(t){return!!t.isCorrect})&&this.hints.column.every(function(t){return!!t.isCorrect});i&&this.succeed()}else 0===n&&1!==this.grid[t][e]&&(this.grid[t][e]="filling"===this.draw.mode?0:2,this.print())}},{key:"printCell",value:function(t){var e=this.ctx,n=2*this.canvas.width/3/(this.n+1);switch(t){case 1:e.fillStyle=this.theme.filledColor,e.fillRect(.05*-n,.05*-n,1.1*n,1.1*n);break;case 0:e.strokeStyle=h.default.red,e.lineWidth=n/15,e.beginPath(),e.moveTo(.3*n,.3*n),e.lineTo(.7*n,.7*n),e.moveTo(.3*n,.7*n),e.lineTo(.7*n,.3*n),e.stroke()}}},{key:"printController",value:function(){function t(){n.save(),n.translate(l,0),n.fillStyle=this.theme.meshColor,n.fillRect(0,0,a,a),n.fillStyle=this.theme.filledColor,n.fillRect(c,c,u,u),n.restore()}function e(){n.save(),n.translate(0,l),n.fillStyle=this.theme.meshColor,n.fillRect(0,0,a,a),n.clearRect(c,c,u,u),n.strokeStyle=h.default.red,n.lineWidth=c,n.beginPath(),n.moveTo(.3*a,.3*a),n.lineTo(.7*a,.7*a),n.moveTo(.3*a,.7*a),n.lineTo(.7*a,.3*a),n.stroke(),n.restore()}var n=this.ctx,i=this.canvas,r=i.width,s=i.height,o=Math.min(r,s)/4,a=3*o/4,l=o/4,c=o/20,u=a-2*c;n.clearRect(2*r/3-1,2*s/3-1,r/3+1,s/3+1),n.save(),n.translate(.7*r,.7*s),1===this.brush?(e.call(this),t.call(this)):0===this.brush&&(t.call(this),e.call(this)),n.restore()}},{key:"succeed",value:function(){function t(){var t=2*l,e=t/10,n=document.createElement("canvas");n.width=t,n.height=t;var i=n.getContext("2d")||new CanvasRenderingContext2D;return i.translate(t/3,5*t/6),i.rotate(-Math.PI/4),i.fillStyle=h.default.green,i.fillRect(0,0,e,-t*Math.SQRT2/3),i.fillRect(0,0,t*Math.SQRT2*2/3,-e),n}function e(t){return 1+Math.pow(t-1,3)}var n=this;this.handleSuccess(),this.listeners.forEach(function(t){var e=o(t,2),i=e[0],r=e[1];n.canvas.removeEventListener(i,r)});var i=this.ctx,r=this.canvas,s=r.width,a=r.height,l=Math.min(s,a)/4,c=i.getImageData(0,0,s,a),u=t(),f=0,d=function t(){i.putImageData(c,0,0),f+=.03,i.globalAlpha=e(f),i.clearRect(2*s/3,2*a/3,s/3,a/3),i.drawImage(u,.7*s-(1-e(f))*l/2,.7*a-(1-e(f))*l/2,(2-e(f))*l,(2-e(f))*l),f<=1?requestAnimationFrame(t):n.handleAnimationEnd()};d()}}]),e}(l.default);Object.defineProperty(e,"__esModule",{value:!0}),e.default=c},function(t,e,n){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),l=n(1),h=n(0),c=function(t){return t.reduce(function(t,e){return t+e},0)},u=new Map;u.set(3,1),u.set(4,0),u.set(5,2);var f=function(t){function e(t,n,i){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=o.theme,l=void 0===a?{}:a,c=o.demoMode,u=void 0===c||c,f=o.delay,d=void 0===f?50:f,v=o.onSuccess,m=void 0===v?function(){}:v,w=o.onError,g=void 0===w?function(){}:w;r(this,e);var p=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));p.click=function(t){if(!p.isBusy){var e=p.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(p.n+1),s=p.getLocation(n,i);if("grid"===s){if(p.scanner&&p.scanner.error)return;var o=Math.floor(i/r-.5),a=Math.floor(n/r-.5);2===p.grid[o][a]&&(p.grid[o][a]=1,p.hints.row[o].unchanged=!1,p.hints.column[a].unchanged=!1,p.solve())}else"controller"===s&&p.refresh()}},p.scan=function(){if(p.canvas.nonogram===p&&(p.updateScanner(),!p.scanner.disabled))return p.demoMode&&p.print(),p.scanner.error=!0,p.solveSingleLine(),p.scanner.error?(p.isBusy=!1,p.print(),void p.handleError(new Error("Bad hints at "+p.scanner.direction+" "+(p.scanner.i+1)))):void(p.demoMode?setTimeout(p.scan,p.delay):p.scan())},p.theme.filledColor=h.default.green,p.theme.correctColor=h.default.green,p.theme.wrongColor=h.default.yellow,Object.assign(p.theme,l),p.demoMode=u,p.delay=d,p.handleSuccess=m,p.handleError=g,p.hints={row:t.slice(),column:n.slice()},p.removeNonPositiveHints(),p.m=p.hints.row.length,p.n=p.hints.column.length,p.grid=new Array(p.m);for(var y=0;y<p.m;y+=1)p.grid[y]=new Array(p.n).fill(2);return p.hints.row.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),p.hints.column.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),p.scanner={disabled:!0,direction:"row",i:0,line:[],hints:[],error:!1},p.initCanvas(i),p.print(),p}return o(e,t),a(e,[{key:"initListeners",value:function(){this.listeners=[["click",this.click]]}},{key:"refresh",value:function(){if(!this.isBusy){this.grid=new Array(this.m);for(var t=0;t<this.m;t+=1)this.grid[t]=new Array(this.n).fill(2);this.hints.row.forEach(function(t){t.isCorrect=!1,t.unchanged=!1,delete t.possibleBlanks}),this.hints.column.forEach(function(t){t.isCorrect=!1,t.unchanged=!1,delete t.possibleBlanks}),this.scanner.disabled=!0,this.solve()}}},{key:"solve",value:function(){this.isBusy||(this.isBusy=!0,this.startTime=Date.now(),this.scan())}},{key:"updateScanner",value:function(){var t=void 0;do if(this.scanner.disabled?this.scanner={disabled:!1,direction:"row",i:0,line:[],hints:[],error:!1}:(this.scanner.error=!1,this.scanner.i+=1,void 0===this.hints[this.scanner.direction][this.scanner.i]&&(this.scanner.direction="row"===this.scanner.direction?"column":"row",this.scanner.i=0)),t=this.hints[this.scanner.direction][this.scanner.i],this.hints.row.every(function(t){return!!t.unchanged})&&this.hints.column.every(function(t){return!!t.unchanged}))return this.scanner.disabled=!0,this.isBusy=!1,this.print(),void this.handleSuccess(Date.now()-this.startTime);while(t.isCorrect||t.unchanged)}},{key:"solveSingleLine",value:function(){this.scanner=this.scanner;var t=this.scanner,e=t.direction,n=t.i;this.scanner.hints=this.hints[e][n],this.scanner.hints.unchanged=!0,this.scanner.line=this.getSingleLine(e,n);var i=this.scanner.line.every(function(t){return 2!==t});i||(void 0===this.scanner.hints.possibleBlanks&&(this.scanner.hints.possibleBlanks=[],this.findAllSituations(this.scanner.line.length-c(this.scanner.hints)+1)),this.mergeSituation(),this.setBackToGrid()),this.isLineCorrect(e,n)&&(this.hints[e][n].isCorrect=!0,i&&(this.scanner.error=!1))}},{key:"findAllSituations",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n===this.scanner.hints.length){var i=e.slice(0,this.scanner.hints.length);i[0]-=1,this.scanner.hints.possibleBlanks&&this.scanner.hints.possibleBlanks.push(i)}for(var r=1;r<=t;r+=1)e[n]=r,this.findAllSituations(t-e[n],e,n+1)}},{key:"mergeSituation",value:function(){var t=this,e=this.scanner.hints.possibleBlanks||[];e.forEach(function(n,r){for(var s=[],o=0;o<t.scanner.hints.length;o+=1)s.push.apply(s,i(new Array(n[o]).fill(4))),s.push.apply(s,i(new Array(t.scanner.hints[o]).fill(3)));s.push.apply(s,i(new Array(t.scanner.line.length-s.length).fill(4)));var a=s.some(function(e,n){return 4===e&&1===t.scanner.line[n]||3===e&&0===t.scanner.line[n]});return a?void delete e[r]:(t.scanner.error=!1,void s.forEach(function(e,n){3===e?4===t.scanner.line[n]?t.scanner.line[n]=5:2===t.scanner.line[n]&&(t.scanner.line[n]=3):4===e&&(3===t.scanner.line[n]?t.scanner.line[n]=5:2===t.scanner.line[n]&&(t.scanner.line[n]=4))}))}),this.scanner.hints.possibleBlanks=e.filter(function(t){return null!==t})}},{key:"setBackToGrid",value:function(){var t=this,e=this.scanner,n=e.direction,i=e.i;"row"===n?this.scanner.line.forEach(function(e,n){u.has(e)&&t.grid[i][n]!==u.get(e)&&(t.grid[i][n]=u.get(e),t.hints.column[n].unchanged=!1)}):"column"===n&&this.scanner.line.forEach(function(e,n){u.has(e)&&t.grid[n][i]!==u.get(e)&&(t.grid[n][i]=u.get(e),t.hints.row[n].unchanged=!1)})}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printController(),this.printScanner()}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=s/10;t.width=s,t.height=s;var n=t.getContext("2d")||new CanvasRenderingContext2D;return n.translate(s/2,s/2),n.rotate(Math.PI),n.arc(0,0,s/2-e/2,Math.PI/2,Math.PI/3.9),n.lineWidth=e,n.strokeStyle=o,n.stroke(),n.beginPath(),n.moveTo((s/2+e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),n.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2-2*e)*Math.SQRT1_2),n.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),n.closePath(),n.fillStyle=o,n.fill(),t}var e=this.ctx,n=this.canvas,i=n.width,r=n.height,s=Math.min(i,r)/4,o=this.theme.filledColor;e.clearRect(2*i/3-1,2*r/3-1,i/3+1,r/3+1),this.isBusy||(e.save(),e.translate(.7*i,.7*r),e.drawImage(t(),0,0),e.restore())}},{key:"printScanner",value:function(){if(!this.scanner.disabled){var t=this.ctx,e=this.canvas,n=e.width,i=e.height,r=2*n/3/(this.n+1);t.save(),t.translate(r/2,r/2),t.fillStyle=this.scanner.error?this.theme.wrongColor:this.theme.correctColor,t.globalAlpha=.5,"row"===this.scanner.direction?t.fillRect(0,r*this.scanner.i,n,r):"column"===this.scanner.direction&&t.fillRect(r*this.scanner.i,0,r,i),t.restore()}}}]),e}(l.default);Object.defineProperty(e,"__esModule",{value:!0}),e.default=f},function(t,e,n){"use strict";var i=n(4);e.Solver=i.default;var r=n(2);e.Editor=r.default;var s=n(3);e.Game=s.default}])});