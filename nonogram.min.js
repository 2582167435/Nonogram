!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.nonogram=e():t.nonogram=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return t[n].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var i={};return e.m=t,e.c=i,e.p="/",e(0)}([function(t,e,i){t.exports=i(8)},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e["default"]={greyVeryLight:"#ccc",grey:"#555",greyVeryDark:"#111",blue:"#0ebeff",green:"#47cf73",violet:"#ae63e4",yellow:"#fcd000",red:"#ff3c41"}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.FILLED=!0,e.EMPTY=!1,e.UNSET=void 0,e.TEMPORARILY_FILLED=1,e.TEMPORARILY_EMPTY=-1,e.INCONSTANT=0},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(2),a=i(1),l=n(a),c=function(){function t(){s(this,t)}return r(t,[{key:"getSingleLine",value:function(t,e){var i=[];if("row"===t)for(var n=0;n<this.n;n+=1)i[n]=this.grid[e][n];else if("col"===t)for(var s=0;s<this.m;s+=1)i[s]=this.grid[s][e];return i}},{key:"removeNonPositiveHints",value:function(){function t(t,e,i){i[e]=t.filter(function(t){return t>0})}this.rowHints.forEach(t),this.colHints.forEach(t)}},{key:"getHints",value:function(t,e){return this[t+"Hints"][e].slice()}},{key:"calculateHints",value:function(t,e){var i=[],n=this.getSingleLine(t,e);return n.reduce(function(t,e){return e===o.FILLED&&i.push(t?i.pop()+1:1),e===o.FILLED},!1),i}},{key:"checkCorrectness",value:function(t,e){return this.calculateHints(t,e).toString()===this[t+"Hints"][e].toString()}},{key:"getLocation",value:function(t,e){var i=this.canvas.width,n=this.canvas.height,s=2*i/3,r=2*n/3,o=s/(this.n+1);return t<0||t>=i||e<0||e>=n?"outside":t>=0&&t<=s&&e>=0&&e<r?o/2<=t&&t<s-o/2&&o/2<=e&&e<r-o/2?"grid":"limbo":s<=t&&t<i&&r<=e&&e<n?"controller":"hints"}},{key:"print",value:function(){this.canvas&&(this.printGrid(),this.printHints(),this.printController())}},{key:"printGrid",value:function(){var t=this.canvas.getContext("2d"),e=this.canvas.width,i=this.canvas.height,n=2*e/3/(this.n+1);t.clearRect(-1,-1,2*e/3+1,2*i/3+1),this.isMeshed&&!this.isMeshOnTop&&this.printMesh(),t.save(),t.translate(n/2,n/2);for(var s=0;s<this.m;s+=1)for(var r=0;r<this.n;r+=1)t.save(),t.translate(n*r,n*s),this.printCell(this.grid[s][r]),t.restore();t.restore(),this.isMeshed&&this.isMeshOnTop&&this.printMesh()}},{key:"printCell",value:function(t){var e=this.canvas.getContext("2d"),i=2*this.canvas.width/3/(this.n+1);switch(t){case o.UNSET:e.fillStyle=this.unsetColor,e.fillRect(.05*i,.05*i,.9*i,.9*i);break;case o.FILLED:e.fillStyle=this.filledColor,e.fillRect(.05*-i,.05*-i,1.1*i,1.1*i);break;default:return}}},{key:"printMesh",value:function(){var t=this.canvas.getContext("2d"),e=2*this.canvas.width/3/(this.n+1);t.save(),t.translate(e/2,e/2),t.beginPath();for(var i=1;i<this.m;i+=1)this.isBoldMeshOnly||(t.moveTo(0,i*e),t.lineTo(this.n*e,i*e)),i%this.boldMeshGap===0&&(t.moveTo(0,i*e),t.lineTo(this.n*e,i*e),this.isBoldMeshOnly||(t.moveTo(0,i*e-1),t.lineTo(this.n*e,i*e-1),t.moveTo(0,i*e+1),t.lineTo(this.n*e,i*e+1)));for(var n=1;n<this.n;n+=1)this.isBoldMeshOnly||(t.moveTo(n*e,0),t.lineTo(n*e,this.m*e)),n%this.boldMeshGap===0&&(t.moveTo(n*e,0),t.lineTo(n*e,this.m*e),this.isBoldMeshOnly||(t.moveTo(n*e-1,0),t.lineTo(n*e-1,this.m*e),t.moveTo(n*e+1,0),t.lineTo(n*e+1,this.m*e)));t.lineWidth=1,t.strokeStyle=this.meshColor,t.stroke(),t.restore()}},{key:"printHints",value:function(){function t(t,r,o){e.textAlign="center",e.textBaseline="middle",e.font=s+'pt "Courier New", Inconsolata, Consolas, monospace';var a=this[t+"Hints"][r];e.fillStyle=a.isCorrect?this.correctColor:this.wrongColor,e.globalAlpha=!a.isCorrect&&a.unchangedSinceLastScanned?.5:1,"row"===t?e.fillText(this.rowHints[r][o]||0,2*i/3+s*o,s*(r+.5),.8*s):"col"===t&&e.fillText(this.colHints[r][o]||0,s*(r+.5),2*n/3+s*o,.8*s)}var e=this.canvas.getContext("2d"),i=this.canvas.width,n=this.canvas.height,s=2*i/3/(this.n+1);e.clearRect(2*i/3-1,-1,3*i+1,2*n/3+1),e.clearRect(-1,2*n/3-1,2*i/3+1,n/3+1),e.save(),e.translate(s/2,s/2);for(var r=0;r<this.m;r+=1){for(var o=0;o<this.rowHints[r].length;o+=1)t.call(this,"row",r,o);0===this.rowHints[r].length&&t.call(this,"row",r,0)}for(var a=0;a<this.n;a+=1){for(var l=0;l<this.colHints[a].length;l+=1)t.call(this,"col",a,l);0===this.colHints[a].length&&t.call(this,"col",a,0)}e.restore()}}]),t}();e["default"]=c,Object.assign(c.prototype,{filledColor:l["default"].grey,unsetColor:l["default"].greyVeryLight,correctColor:l["default"].green,wrongColor:l["default"].red,meshColor:l["default"].yellow,isMeshed:!1,isBoldMeshOnly:!1,isMeshOnTop:!1,boldMeshGap:5})},function(t,e){"use strict";function i(t){this.listeners=this.listeners||{},this.removeEventListener(t,this.listeners[t])}function n(t,e){i.call(this,t),this.addEventListener(t,e),this.listeners[t]=e}Object.defineProperty(e,"__esModule",{value:!0}),e.off=i,e.on=n},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(3),c=n(l),h=i(2),u=i(1),d=n(u),f=i(4),v=function(t){function e(t,i,n,o){s(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(o=o||{},Object.assign(a,o),a.handleHintChange=o.onHintChange||function(){},a.m=t,a.n=i,a.grid)a.grid.forEach(function(t){t.forEach(function(t,e,i){i[e]=t?h.FILLED:h.EMPTY})});else{a.grid=new Array(a.m);for(var l=0;l<a.m;l+=1){a.grid[l]=new Array(a.n);for(var c=0;c<a.n;c+=1)a.grid[l][c]=Math.random()<a.threshold?h.FILLED:h.EMPTY}}a.rowHints=new Array(t),a.colHints=new Array(i);for(var u=0;u<a.m;u+=1)a.rowHints[u]=a.calculateHints("row",u),a.rowHints[u].isCorrect=!0;for(var d=0;d<a.n;d+=1)a.colHints[d]=a.calculateHints("col",d),a.colHints[d].isCorrect=!0;return a.canvas=n instanceof HTMLCanvasElement?n:document.getElementById(n),!a.canvas||a.canvas.dataset.isBusy?r(a):(a.canvas.width=a.width||a.canvas.clientWidth,a.canvas.height=a.canvas.width*(a.m+1)/(a.n+1),f.on.call(a.canvas,"mousedown",a.mousedown.bind(a)),f.on.call(a.canvas,"mousemove",a.mousemove.bind(a)),f.on.call(a.canvas,"mouseup",a.brushUp.bind(a)),f.on.call(a.canvas,"mouseleave",a.brushUp.bind(a)),a.canvas.oncontextmenu=function(t){t.preventDefault()},a.draw={},a.print(),a.handleHintChange(a.rowHints,a.colHints),a)}return o(e,t),a(e,[{key:"mousedown",value:function(t){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,s=2*e.width/3/(this.n+1),r=this.getLocation(i,n);if("controller"===r)this.refresh();else if("grid"===r){this.draw.firstI=Math.floor(n/s-.5),this.draw.firstJ=Math.floor(i/s-.5);var o=this.grid[this.draw.firstI][this.draw.firstJ];this.draw.brush=o===h.FILLED?h.EMPTY:h.FILLED,this.isPressed=!0,this.switchCell(this.draw.firstI,this.draw.firstJ),this.draw.lastI=this.draw.firstI,this.draw.lastJ=this.draw.firstJ}}},{key:"mousemove",value:function(t){if(this.isPressed){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,s=2*e.width/3/(this.n+1);if("grid"===this.getLocation(i,n)){var r=Math.floor(n/s-.5),o=Math.floor(i/s-.5);r===this.draw.lastI&&o===this.draw.lastJ||(void 0===this.draw.direction&&(r===this.draw.firstI?this.draw.direction="row":o===this.draw.firstJ&&(this.draw.direction="col")),("row"===this.draw.direction&&r===this.draw.firstI||"col"===this.draw.direction&&o===this.draw.firstJ)&&(this.switchCell(r,o),this.draw.lastI=r,this.draw.lastJ=o))}}}},{key:"brushUp",value:function(){delete this.isPressed,this.draw={}}},{key:"switchCell",value:function(t,e){this.grid[t][e]=this.draw.brush,this.rowHints[t]=this.calculateHints("row",t),this.rowHints[t].isCorrect=!0,this.colHints[e]=this.calculateHints("col",e),this.colHints[e].isCorrect=!0,this.print(),this.handleHintChange(this.rowHints,this.colHints)}},{key:"refresh",value:function(){for(var t=0;t<this.m;t+=1)for(var e=0;e<this.n;e+=1)this.grid[t][e]=Math.random()<this.threshold?h.FILLED:h.EMPTY;for(var i=0;i<this.m;i+=1)this.rowHints[i]=this.calculateHints("row",i),this.rowHints[i].isCorrect=!0;for(var n=0;n<this.n;n+=1)this.colHints[n]=this.calculateHints("col",n),this.colHints[n].isCorrect=!0;this.print(),this.handleHintChange(this.rowHints,this.colHints)}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=s/10;t.width=s,t.height=s;var i=t.getContext("2d");return i.translate(s/2,s/2),i.arc(0,0,s/2-e/2,Math.PI/2,Math.PI/3.9),i.lineWidth=e,i.strokeStyle=r,i.stroke(),i.beginPath(),i.moveTo((s/2+e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),i.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2-2*e)*Math.SQRT1_2),i.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),i.closePath(),i.fillStyle=r,i.fill(),t}var e=this.canvas.getContext("2d"),i=this.canvas.width,n=this.canvas.height,s=Math.min(i,n)/4,r=this.filledColor;e.clearRect(2*i/3-1,2*n/3-1,i/3+1,n/3+1),e.save(),e.translate(.7*i,.7*n),e.drawImage(t(),0,0),e.restore()}}]),e}(c["default"]);e["default"]=v,Object.assign(v.prototype,{filledColor:d["default"].violet,correctColor:d["default"].violet,threshold:.5})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),l=i(3),c=n(l),h=i(2),u=i(1),d=n(u),f=i(4),v=function(t,e){return t.toString()===e.toString()},w=function(t){function e(t,i,n,o){s(this,e);var a=r(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));o=o||{},Object.assign(a,o),a.handleSucceed=o.onSucceed||function(){},a.handleAnimationEnd=o.onAnimationEnd||function(){},a.rowHints=t.slice(),a.colHints=i.slice(),a.removeNonPositiveHints(),a.m=t.length,a.n=i.length,a.grid=new Array(a.m);for(var l=0;l<a.m;l+=1)a.grid[l]=new Array(a.n).fill(h.UNSET);return a.rowHints.forEach(function(t,e){t.isCorrect=a.checkCorrectness("row",e)}),a.colHints.forEach(function(t,e){t.isCorrect=a.checkCorrectness("col",e)}),a.canvas=n instanceof HTMLCanvasElement?n:document.getElementById(n),!a.canvas||a.canvas.dataset.isBusy?r(a):(a.canvas.width=a.width||a.canvas.clientWidth,a.canvas.height=a.canvas.width*(a.m+1)/(a.n+1),f.on.call(a.canvas,"mousedown",a.mousedown.bind(a)),f.on.call(a.canvas,"mousemove",a.mousemove.bind(a)),f.on.call(a.canvas,"mouseup",a.brushUp.bind(a)),f.on.call(a.canvas,"mouseleave",a.brushUp.bind(a)),a.canvas.oncontextmenu=function(t){t.preventDefault()},a.brush=h.FILLED,a.draw={},a.print(),a)}return o(e,t),a(e,[{key:"mousedown",value:function(t){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,s=2*e.width/3/(this.n+1),r=this.getLocation(i,n);if("controller"===r)this.switchBrush();else if("grid"===r){this.draw.firstI=Math.floor(n/s-.5),this.draw.firstJ=Math.floor(i/s-.5),this.draw.inverted=2===t.button;var o=this.grid[this.draw.firstI][this.draw.firstJ],a=this.brush;this.draw.inverted&&(a=this.brush===h.FILLED?h.EMPTY:h.FILLED),o!==h.UNSET&&a!==o||(this.draw.mode=a===o?"empty":"filling",this.isPressed=!0,this.switchCell(this.draw.firstI,this.draw.firstJ)),this.draw.lastI=this.draw.firstI,this.draw.lastJ=this.draw.firstJ}}},{key:"mousemove",value:function(t){if(this.isPressed){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,s=2*e.width/3/(this.n+1);if("grid"===this.getLocation(i,n)){var r=Math.floor(n/s-.5),o=Math.floor(i/s-.5);r===this.draw.lastI&&o===this.draw.lastJ||(void 0===this.draw.direction&&(r===this.draw.firstI?this.draw.direction="row":o===this.draw.firstJ&&(this.draw.direction="col")),("row"===this.draw.direction&&r===this.draw.firstI||"col"===this.draw.direction&&o===this.draw.firstJ)&&(this.switchCell(r,o),this.draw.lastI=r,this.draw.lastJ=o))}}}},{key:"switchBrush",value:function(){this.brush=this.brush===h.EMPTY?h.FILLED:h.EMPTY,this.printController()}},{key:"brushUp",value:function(){delete this.isPressed,this.draw={}}},{key:"switchCell",value:function(t,e){var i=this.brush;if(this.draw.inverted&&(i=this.brush===h.FILLED?h.EMPTY:h.FILLED),i===h.FILLED&&this.grid[t][e]!==h.EMPTY){this.grid[t][e]="filling"===this.draw.mode?h.FILLED:h.UNSET,this.rowHints[t].isCorrect=v(this.calculateHints("row",t),this.rowHints[t]),this.colHints[e].isCorrect=v(this.calculateHints("col",e),this.colHints[e]),this.print();var n=this.rowHints.every(function(t){return t.isCorrect})&&this.colHints.every(function(t){return t.isCorrect});n&&this.succeed()}else i===h.EMPTY&&this.grid[t][e]!==h.FILLED&&(this.grid[t][e]="filling"===this.draw.mode?h.EMPTY:h.UNSET,this.print())}},{key:"printCell",value:function(t){var e=this.canvas.getContext("2d"),i=2*this.canvas.width/3/(this.n+1);switch(t){case h.FILLED:e.fillStyle=this.filledColor,e.fillRect(.05*-i,.05*-i,1.1*i,1.1*i);break;case h.EMPTY:e.strokeStyle=this.emptyColor,e.lineWidth=i/15,e.beginPath(),e.moveTo(.3*i,.3*i),e.lineTo(.7*i,.7*i),e.moveTo(.3*i,.7*i),e.lineTo(.7*i,.3*i),e.stroke();break;default:return}}},{key:"printController",value:function(){function t(){i.save(),i.translate(a,0),i.fillStyle=this.meshColor,i.fillRect(0,0,o,o),i.fillStyle=this.filledColor,i.fillRect(l,l,c,c),i.restore()}function e(){i.save(),i.translate(0,a),i.fillStyle=this.meshColor,i.fillRect(0,0,o,o),i.clearRect(l,l,c,c),i.strokeStyle=d["default"].red,i.lineWidth=l,i.beginPath(),i.moveTo(.3*o,.3*o),i.lineTo(.7*o,.7*o),i.moveTo(.3*o,.7*o),i.lineTo(.7*o,.3*o),i.stroke(),i.restore()}var i=this.canvas.getContext("2d"),n=this.canvas.width,s=this.canvas.height,r=Math.min(n,s)/4,o=3*r/4,a=r/4,l=r/20,c=o-2*l;i.clearRect(2*n/3-1,2*s/3-1,n/3+1,s/3+1),i.save(),i.translate(.7*n,.7*s),this.brush===h.FILLED?(e.call(this),t.call(this)):this.brush===h.EMPTY&&(t.call(this),e.call(this)),i.restore()}},{key:"succeed",value:function(){function t(){var t=2*o,e=t/10,i=document.createElement("canvas");i.width=t,i.height=t;var n=i.getContext("2d");return n.translate(t/3,5*t/6),n.rotate(-Math.PI/4),n.fillStyle=d["default"].green,n.fillRect(0,0,e,-t*Math.SQRT2/3),n.fillRect(0,0,t*Math.SQRT2*2/3,-e),i}function e(t){return 1+Math.pow(t-1,3)}function i(){n.putImageData(a,0,0),c+=.03,n.globalAlpha=e(c),n.clearRect(2*s/3,2*r/3,s/3,r/3),n.drawImage(l,.7*s-(1-e(c))*o/2,.7*r-(1-e(c))*o/2,(2-e(c))*o,(2-e(c))*o),c<=1?requestAnimationFrame(i.bind(this)):this.handleAnimationEnd()}if(this.canvas){this.handleSucceed(),f.off.call(this.canvas,"mousedown"),f.off.call(this.canvas,"mousemove"),f.off.call(this.canvas,"mouseup"),f.off.call(this.canvas,"mouseleave");var n=this.canvas.getContext("2d"),s=this.canvas.width,r=this.canvas.height,o=Math.min(s,r)/4,a=n.getImageData(0,0,s,r),l=t(),c=0;i.call(this)}}}]),e}(c["default"]);e["default"]=w,Object.assign(w.prototype,{filledColor:d["default"].blue,emptyColor:d["default"].red,wrongColor:d["default"].grey,isMeshed:!0})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}function s(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),c=i(3),h=n(c),u=i(2),d=i(1),f=n(d),v=i(4),w=function(t){return t.reduce(function(t,e){return t+e},0)},g=new Map;g.set(u.TEMPORARILY_FILLED,u.FILLED),g.set(u.TEMPORARILY_EMPTY,u.EMPTY),g.set(u.INCONSTANT,u.UNSET);var p=function(t){function e(t,i,n,s){r(this,e);var a=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));s=s||{},Object.assign(a,s),a.handleSucceed=s.onSucceed||function(){},a.handleError=s.onError||function(){},a.rowHints=t.slice(),a.colHints=i.slice(),a.removeNonPositiveHints(),a.m=t.length,a.n=i.length,a.grid=new Array(a.m);for(var l=0;l<a.m;l+=1)a.grid[l]=new Array(a.n);return a.rowHints.forEach(function(t){t.isCorrect=!1,t.unchangedSinceLastScanned=!1}),a.colHints.forEach(function(t){t.isCorrect=!1,t.unchangedSinceLastScanned=!1}),a.canvas=n instanceof HTMLCanvasElement?n:document.getElementById(n),!a.canvas||a.canvas.dataset.isBusy?o(a):(a.canvas.width=a.width||a.canvas.clientWidth,a.canvas.height=a.canvas.width*(a.m+1)/(a.n+1),v.on.call(a.canvas,"click",a.click.bind(a)),a.canvas.oncontextmenu=function(t){t.preventDefault()},a.print(),a)}return a(e,t),l(e,[{key:"click",value:function(t){if(!this.canvas.dataset.isBusy){var e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,n=t.clientY-e.top,s=2*e.width/3/(this.n+1),r=this.getLocation(i,n);if("grid"===r){if(this.scanner&&this.scanner.error)return;var o=Math.floor(n/s-.5),a=Math.floor(i/s-.5);this.grid[o][a]===u.UNSET&&(this.grid[o][a]=u.FILLED,this.rowHints[o].unchangedSinceLastScanned=!1,this.colHints[a].unchangedSinceLastScanned=!1,this.solve())}else"controller"===r&&this.refresh()}}},{key:"refresh",value:function(){if(!this.canvas.dataset.isBusy){this.grid=new Array(this.m);for(var t=0;t<this.m;t+=1)this.grid[t]=new Array(this.n);this.rowHints.forEach(function(t){t.isCorrect=!1,t.unchangedSinceLastScanned=!1}),this.colHints.forEach(function(t){t.isCorrect=!1,t.unchangedSinceLastScanned=!1}),delete this.scanner,this.solve()}}},{key:"solve",value:function(){this.canvas.dataset.isBusy||(this.canvas.dataset.isBusy=1,this.startTime=Date.now(),this.scan())}},{key:"scan",value:function(){if(this.updateScanner(),void 0!==this.scanner)return this.demoMode&&this.print(),this.scanner.error=!0,this.solveSingleLine(),this.scanner.error?void(this.canvas&&(this.canvas.dataset.isBusy="",this.print(),this.handleError(new Error("Bad hints at "+this.scanner.direction+" "+(this.scanner.i+1))))):void(this.demoMode?setTimeout(this.scan.bind(this),this.delay):this.scan())}},{key:"updateScanner",value:function(){var t=void 0;do if(void 0===this.scanner?this.scanner={direction:"row",i:0}:(this.scanner.error=!1,this.scanner.i+=1,void 0===this[this.scanner.direction+"Hints"][this.scanner.i]&&(this.scanner.direction="row"===this.scanner.direction?"col":"row",this.scanner.i=0)),t=this[this.scanner.direction+"Hints"][this.scanner.i],this.rowHints.every(function(t){return t.unchangedSinceLastScanned})&&this.colHints.every(function(t){return t.unchangedSinceLastScanned}))return delete this.scanner,void(this.canvas&&(this.canvas.dataset.isBusy="",this.print(),this.handleSucceed(Date.now()-this.startTime)));while(t.isCorrect||t.unchangedSinceLastScanned)}},{key:"solveSingleLine",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scanner.direction,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scanner.i;this[t+"Hints"][e].unchangedSinceLastScanned=!0,this.line=this.getSingleLine(t,e);var i=this.line.every(function(t){return t!==u.UNSET});i||(this.hints=this.getHints(t,e),this.blanks=[],this.getAllSituations(this.line.length-w(this.hints)+1),this.setBackToGrid(t,e)),this.checkCorrectness(t,e)&&(this[t+"Hints"][e].isCorrect=!0,i&&(this.scanner.error=!1))}},{key:"getAllSituations",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i===this.hints.length&&(this.blanks=e.slice(0,this.hints.length),this.blanks[0]-=1,this.mergeSituation());for(var n=1;n<=t;n+=1)e[i]=n,this.getAllSituations(t-e[i],e,i+1)}},{key:"mergeSituation",value:function(){for(var t=this,e=[],i=0;i<this.hints.length;i+=1)e.push.apply(e,s(new Array(this.blanks[i]).fill(u.TEMPORARILY_EMPTY))),e.push.apply(e,s(new Array(this.hints[i]).fill(u.TEMPORARILY_FILLED)));e.push.apply(e,s(new Array(this.line.length-e.length).fill(u.TEMPORARILY_EMPTY)));var n=e.some(function(e,i){return e===u.TEMPORARILY_EMPTY&&t.line[i]===u.FILLED||e===u.TEMPORARILY_FILLED&&t.line[i]===u.EMPTY});n||(this.scanner.error=!1,e.forEach(function(e,i){e===u.TEMPORARILY_FILLED?t.line[i]===u.TEMPORARILY_EMPTY?t.line[i]=u.INCONSTANT:t.line[i]===u.UNSET&&(t.line[i]=u.TEMPORARILY_FILLED):e===u.TEMPORARILY_EMPTY&&(t.line[i]===u.TEMPORARILY_FILLED?t.line[i]=u.INCONSTANT:t.line[i]===u.UNSET&&(t.line[i]=u.TEMPORARILY_EMPTY))}))}},{key:"setBackToGrid",value:function(t,e){var i=this;"row"===t?this.line.forEach(function(t,n){g.has(t)&&i.grid[e][n]!==g.get(t)&&(i.grid[e][n]=g.get(t),i.colHints[n].unchangedSinceLastScanned=!1)}):"col"===t&&this.line.forEach(function(t,n){g.has(t)&&i.grid[n][e]!==g.get(t)&&(i.grid[n][e]=g.get(t),i.rowHints[n].unchangedSinceLastScanned=!1)})}},{key:"print",value:function(){this.canvas&&(this.printGrid(),this.printHints(),this.printController(),this.printScanner())}},{key:"printController",value:function(){function t(){var t=document.createElement("canvas"),e=s/10;t.width=s,t.height=s;var i=t.getContext("2d");return i.translate(s/2,s/2),i.rotate(Math.PI),i.arc(0,0,s/2-e/2,Math.PI/2,Math.PI/3.9),i.lineWidth=e,i.strokeStyle=r,i.stroke(),i.beginPath(),i.moveTo((s/2+e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),i.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2-2*e)*Math.SQRT1_2),i.lineTo((s/2-2*e)*Math.SQRT1_2,(s/2+e)*Math.SQRT1_2),i.closePath(),i.fillStyle=r,i.fill(),t}var e=this.canvas.getContext("2d"),i=this.canvas.width,n=this.canvas.height,s=Math.min(i,n)/4,r=this.filledColor;e.clearRect(2*i/3-1,2*n/3-1,i/3+1,n/3+1),this.canvas.dataset.isBusy||(e.save(),e.translate(.7*i,.7*n),e.drawImage(t(),0,0),e.restore())}},{key:"printScanner",value:function(){if(void 0!==this.scanner){var t=this.canvas.getContext("2d"),e=this.canvas.width,i=this.canvas.height,n=2*e/3/(this.n+1);t.save(),t.translate(n/2,n/2),t.fillStyle=this.scanner.error?this.wrongColor:this.correctColor,t.globalAlpha=.5,"row"===this.scanner.direction?t.fillRect(0,n*this.scanner.i,e,n):"col"===this.scanner.direction&&t.fillRect(n*this.scanner.i,0,n,i),t.restore()}}}]),e}(h["default"]);e["default"]=p,Object.assign(p.prototype,{filledColor:f["default"].green,correctColor:f["default"].green,wrongColor:f["default"].yellow,demoMode:!0,delay:50})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Game=e.Editor=e.Solver=void 0;var s=i(7),r=n(s),o=i(5),a=n(o),l=i(6),c=n(l);e.Solver=r["default"],e.Editor=a["default"],e.Game=c["default"]}])});