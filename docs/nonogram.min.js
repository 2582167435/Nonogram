var nonogram=function(t){"use strict";function e(t){try{return v.createObjectURL(new Blob([t],{type:d}))}catch(n){var e=new f;return e.append(t),v.createObjectURL(e.getBlob(type))}}var n={greyVeryLight:"#ccc",grey:"#555",greyVeryDark:"#111",blue:"#0ebeff",green:"#47cf73",violet:"#ae63e4",yellow:"#fcd000",red:"#ff3c41"},i={EMPTY:0,FILLED:1,UNSET:2,TEMP_FILLED:3,TEMP_EMPTY:4,INCONSTANT:5},r=(function(){function t(t){this.value=t}function e(e){function n(r,s){try{var o=e[r](s),a=o.value;a instanceof t?Promise.resolve(a.value).then(function(t){n("next",t)},function(t){n("throw",t)}):i(o.done?"return":"normal",o.value)}catch(t){i("throw",t)}}function i(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}(r=r.next)?n(r.key,r.arg):s=null}var r,s;this._invoke=function(t,e){return new Promise(function(i,o){var a={key:t,arg:e,resolve:i,reject:o,next:null};s?s=s.next=a:(r=s=a,n(t,e))})},"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},h=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,r=!1,s=void 0;try{for(var o,a=t[Symbol.iterator]();!(i=(o=a.next()).done)&&(n.push(o.value),!e||n.length!==e);i=!0);}catch(t){r=!0,s=t}finally{try{!i&&a.return&&a.return()}finally{if(r)throw s}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},c=function(){function t(){r(this,t),this.theme={filledColor:n.grey,unsetColor:n.greyVeryLight,correctColor:n.green,wrongColor:n.red,meshColor:n.yellow,isMeshed:!1,isBoldMeshOnly:!1,isMeshOnTop:!1,boldMeshGap:5}}return s(t,[{key:"initCanvas",value:function(t){var e=this,n=t instanceof HTMLCanvasElement?t:document.getElementById(t);n instanceof HTMLCanvasElement||(n=document.createElement("canvas")),this.canvas=n,this.canvas.nonogram&&this.canvas.nonogram.listeners.forEach(function(t){var n=h(t,2),i=n[0],r=n[1];e.canvas.removeEventListener(i,r)}),this.canvas.nonogram=this,this.canvas.width=this.theme.width||this.canvas.clientWidth,this.canvas.height=this.canvas.width*(this.m+1)/(this.n+1),this.ctx=this.canvas.getContext("2d")||new CanvasRenderingContext2D,this.initListeners(),this.listeners.forEach(function(t){var n=h(t,2),i=n[0],r=n[1];e.canvas.addEventListener(i,r)}),this.canvas.oncontextmenu=function(t){t.preventDefault()}}},{key:"initListeners",value:function(){this.listeners=[]}},{key:"removeNonPositiveHints",value:function(){function t(t,e,n){n[e]=t.filter(function(t){return t>0})}this.hints.row.forEach(t),this.hints.column.forEach(t)}},{key:"getSingleLine",value:function(t,e){var n=[];if("row"===t)for(var i=0;i<this.n;i+=1)n[i]=this.grid[e][i];else if("column"===t)for(var r=0;r<this.m;r+=1)n[r]=this.grid[r][e];return n}},{key:"calculateHints",value:function(t,e){var n=[];return this.getSingleLine(t,e).reduce(function(t,e){if(e===i.FILLED)n.push(t?n.pop()+1:1);else if(e!==i.EMPTY)throw new Error;return e===i.FILLED},!1),n}},{key:"isLineCorrect",value:function(t,e){try{return function(t,e){return t.length===e.length&&t.every(function(t,n){return t===e[n]})}(this.calculateHints(t,e),this.hints[t][e])}catch(t){return!1}}},{key:"getLocation",value:function(t,e){var n=this.canvas.getBoundingClientRect(),i=n.width,r=n.height,s=2*i/3,o=2*r/3,a=s/(this.n+1);return t<0||t>=i||e<0||e>=r?"outside":t>=0&&t<=s&&e>=0&&e<o?a/2<=t&&t<s-a/2&&a/2<=e&&e<o-a/2?"grid":"limbo":s<=t&&t<i&&o<=e&&e<r?"controller":"hints"}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printController()}},{key:"printGrid",value:function(){var t=this.ctx,e=this.canvas,n=e.width,i=e.height,r=2*n/3/(this.n+1);t.clearRect(-1,-1,2*n/3+1,2*i/3+1),this.theme.isMeshed&&!this.theme.isMeshOnTop&&this.printMesh(),t.save(),t.translate(r/2,r/2);for(var s=0;s<this.m;s+=1)for(var o=0;o<this.n;o+=1)t.save(),t.translate(r*o,r*s),this.printCell(this.grid[s][o]),t.restore();t.restore(),this.theme.isMeshed&&this.theme.isMeshOnTop&&this.printMesh()}},{key:"printCell",value:function(t){var e=this.ctx,n=2*this.canvas.width/3/(this.n+1);switch(t){case i.UNSET:e.fillStyle=this.theme.unsetColor,e.fillRect(.05*n,.05*n,.9*n,.9*n);break;case i.FILLED:e.fillStyle=this.theme.filledColor,e.fillRect(.05*-n,.05*-n,1.1*n,1.1*n)}}},{key:"printMesh",value:function(){var t=this.ctx,e=2*this.canvas.width/3/(this.n+1);t.save(),t.translate(e/2,e/2),t.beginPath();for(var n=1;n<this.m;n+=1)this.theme.isBoldMeshOnly||(t.moveTo(0,n*e),t.lineTo(this.n*e,n*e)),n%this.theme.boldMeshGap==0&&(t.moveTo(0,n*e),t.lineTo(this.n*e,n*e),this.theme.isBoldMeshOnly||(t.moveTo(0,n*e-1),t.lineTo(this.n*e,n*e-1),t.moveTo(0,n*e+1),t.lineTo(this.n*e,n*e+1)));for(var i=1;i<this.n;i+=1)this.theme.isBoldMeshOnly||(t.moveTo(i*e,0),t.lineTo(i*e,this.m*e)),i%this.theme.boldMeshGap==0&&(t.moveTo(i*e,0),t.lineTo(i*e,this.m*e),this.theme.isBoldMeshOnly||(t.moveTo(i*e-1,0),t.lineTo(i*e-1,this.m*e),t.moveTo(i*e+1,0),t.lineTo(i*e+1,this.m*e)));t.lineWidth=1,t.strokeStyle=this.theme.meshColor,t.stroke(),t.restore()}},{key:"printHints",value:function(){var t=this.ctx,e=this.canvas,n=e.width,i=e.height,r=2*n/3/(this.n+1);t.clearRect(2*n/3-1,-1,3*n+1,2*i/3+1),t.clearRect(-1,2*i/3-1,2*n/3+1,i/3+1),t.save(),t.translate(r/2,r/2);for(var s=0;s<this.m;s+=1){for(var o=0;o<this.hints.row[s].length;o+=1)this.printSingleHint("row",s,o);0===this.hints.row[s].length&&this.printSingleHint("row",s,0)}for(var a=0;a<this.n;a+=1){for(var h=0;h<this.hints.column[a].length;h+=1)this.printSingleHint("column",a,h);0===this.hints.column[a].length&&this.printSingleHint("column",a,0)}t.restore()}},{key:"printSingleHint",value:function(t,e,n){var i=this.ctx,r=this.canvas,s=r.width,o=r.height,a=2*s/3/(this.n+1);i.textAlign="center",i.textBaseline="middle",i.font=a+'pt "Courier New", Inconsolata, Consolas, monospace';var h=this.hints[t][e];i.fillStyle=h.isCorrect?this.theme.correctColor:this.theme.wrongColor,i.globalAlpha=!h.isCorrect&&h.unchanged?.5:1,"row"===t?i.fillText(""+(this.hints.row[e][n]||0),2*s/3+a*n,a*(e+.5),.8*a):"column"===t&&i.fillText(""+(this.hints.column[e][n]||0),a*(e+.5),2*o/3+a*n,.8*a)}}]),t}(),u="undefined"==typeof Symbol?"__target":Symbol(),d="application/javascript",f=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,v=window.URL||window.webkitURL,g=window.Worker;if(g){var m,w=e("self.onmessage = function () {}"),y=new Uint8Array(1);try{if(/(?:Trident|Edge)\/(?:[567]|12)/i.test(navigator.userAgent))throw new Error("Not available");(m=new g(w)).postMessage(y,[y.buffer])}catch(t){g=null}finally{v.revokeObjectURL(w),m&&m.terminate()}}var p=new function(t,n){return function(i){var r=this;if(!n)return new g(t);if(g&&!i){var s=e((""+n).replace(/^function.+?{/,"").slice(0,-1));return this[u]=new g(s),v.revokeObjectURL(s),this[u]}var o={postMessage:function(t){r.onmessage&&setTimeout(function(){return r.onmessage({data:t,target:o})})}};n.call(o),this.postMessage=function(t){setTimeout(function(){return o.onmessage({data:t,target:r})})},this.isThisThread=!0}}("./worker.ts",function(t,e){var n={EMPTY:0,FILLED:1,UNSET:2,TEMP_FILLED:3,TEMP_EMPTY:4,INCONSTANT:5},i=new Map;i.set(n.TEMP_FILLED,n.FILLED),i.set(n.TEMP_EMPTY,n.EMPTY),i.set(n.INCONSTANT,n.UNSET);var o=function(){function t(e){var i=this;r(this,t),this.scan=function(){if(i.updateScanner()){i.delay&&(i.message={type:"update",grid:i.grid,scanner:i.scanner,hints:i.hints},postMessage(i.message)),i.isError=!0;var t=i.scanner,e=t.direction,r=t.i;if(i.currentHints=i.hints[e][r],i.currentHints.unchanged=!0,i.currentLine=i.getSingleLine(e,r),i.currentLine.every(function(t){return t!==n.UNSET})||(i.solveSingleLine(),i.setBackToGrid(i.currentLine)),i.isLineCorrect(e,r)&&(i.hints[e][r].isCorrect=!0,i.isError=!1),i.isError)return i.message={type:"error",grid:i.grid,scanner:i.scanner,hints:i.hints},void postMessage(i.message);i.delay?setTimeout(i.scan,i.delay):i.scan()}},this.hints=e.hints,this.delay=e.delay,this.grid=e.grid,this.scanner={direction:"row",i:-1},this.possibleBlanks={row:[],column:[]},this.scan()}return s(t,[{key:"getSingleLine",value:function(t,e){var n=[],i=this.grid.length,r=this.grid.length&&this.grid[0].length;if("row"===t)for(var s=0;s<r;s+=1)n[s]=this.grid[e][s];else if("column"===t)for(var o=0;o<i;o+=1)n[o]=this.grid[o][e];return n}},{key:"calculateHints",value:function(t,e){var i=[];return this.getSingleLine(t,e).reduce(function(t,e){if(e===n.FILLED)i.push(t?i.pop()+1:1);else if(e!==n.EMPTY)throw new Error;return e===n.FILLED},!1),i}},{key:"isLineCorrect",value:function(t,e){try{return function(t,e){return t.length===e.length&&t.every(function(t,n){return t===e[n]})}(this.calculateHints(t,e),this.hints[t][e])}catch(t){return!1}}},{key:"updateScanner",value:function(){var t=void 0;do{if(this.isError=!1,this.scanner.i+=1,void 0===this.hints[this.scanner.direction][this.scanner.i]&&(this.scanner.direction="row"===this.scanner.direction?"column":"row",this.scanner.i=0),t=this.hints[this.scanner.direction][this.scanner.i],this.hints.row.every(function(t){return!!t.unchanged})&&this.hints.column.every(function(t){return!!t.unchanged}))return this.message={type:"finish",grid:this.grid,hints:this.hints},postMessage(this.message),!1}while(t.isCorrect||t.unchanged);return!0}},{key:"setBackToGrid",value:function(t){var e=this,n=this.scanner,r=n.direction,s=n.i;"row"===r?t.forEach(function(t,n){i.has(t)&&e.grid[s][n]!==i.get(t)&&(e.grid[s][n]=i.get(t),e.hints.column[n].unchanged=!1)}):"column"===r&&t.forEach(function(t,n){i.has(t)&&e.grid[n][s]!==i.get(t)&&(e.grid[n][s]=i.get(t),e.hints.row[n].unchanged=!1)})}},{key:"solveSingleLine",value:function(){this.isError=!0;var t=this.scanner,e=t.direction,n=t.i;void 0===this.possibleBlanks[e][n]&&(this.possibleBlanks[e][n]=[],this.findAll(this.currentLine.length-function(t){return t.reduce(function(t,e){return t+e},0)}(this.currentHints)+1)),this.merge()}},{key:"findAll",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n===this.currentHints.length){var i=e.slice(0,this.currentHints.length);i[0]-=1;var r=this.scanner,s=r.direction,o=r.i;this.possibleBlanks[s][o]&&this.possibleBlanks[s][o].push(i)}for(var a=1;a<=t;a+=1)e[n]=a,this.findAll(t-e[n],e,n+1)}},{key:"merge",value:function(){var t=this,e=this.scanner,i=e.direction,r=e.i,s=this.possibleBlanks[i][r];s.forEach(function(e,i){for(var r=[],o=0;o<t.currentHints.length;o+=1)r.push.apply(r,l(new Array(e[o]).fill(n.TEMP_EMPTY))),r.push.apply(r,l(new Array(t.currentHints[o]).fill(n.TEMP_FILLED)));r.push.apply(r,l(new Array(t.currentLine.length-r.length).fill(n.TEMP_EMPTY))),r.some(function(e,i){return e===n.TEMP_EMPTY&&t.currentLine[i]===n.FILLED||e===n.TEMP_FILLED&&t.currentLine[i]===n.EMPTY})?delete s[i]:(t.isError=!1,r.forEach(function(e,i){e===n.TEMP_FILLED?t.currentLine[i]===n.TEMP_EMPTY?t.currentLine[i]=n.INCONSTANT:t.currentLine[i]===n.UNSET&&(t.currentLine[i]=n.TEMP_FILLED):e===n.TEMP_EMPTY&&(t.currentLine[i]===n.TEMP_FILLED?t.currentLine[i]=n.INCONSTANT:t.currentLine[i]===n.UNSET&&(t.currentLine[i]=n.TEMP_EMPTY))}))}),this.possibleBlanks[i][r]=s.filter(function(t){return t})}}]),t}();onmessage=function(t){var e=t.data;new o(e)}}),E=function(t){function e(t,s,o){var h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=h.theme,c=void 0===l?{}:l,u=h.delay,d=void 0===u?50:u,f=h.onSuccess,v=void 0===f?function(){}:f,g=h.onError,m=void 0===g?function(){}:g;r(this,e);var w=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));w.worker=new p,w.click=function(t){if(!w.isBusy){var e=w.canvas.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top,s=2*e.width/3/(w.n+1),o=w.getLocation(n,r);if("grid"===o){if(w.isError)return;var a=Math.floor(r/s-.5),h=Math.floor(n/s-.5);w.grid[a][h]===i.UNSET&&(w.grid[a][h]=i.FILLED,w.hints.row[a].unchanged=!1,w.hints.column[h].unchanged=!1,w.solve())}else"controller"===o&&w.refresh()}},w.theme.filledColor=n.green,w.theme.correctColor=n.green,w.theme.wrongColor=n.yellow,Object.assign(w.theme,c),w.delay=d,w.handleSuccess=v,w.handleError=m,w.hints={row:t.slice(),column:s.slice()},w.removeNonPositiveHints(),w.m=w.hints.row.length,w.n=w.hints.column.length,w.grid=new Array(w.m);for(var y=0;y<w.m;y+=1)w.grid[y]=new Array(w.n).fill(i.UNSET);return w.initCanvas(o),w.print(),w}return o(e,c),s(e,[{key:"initListeners",value:function(){this.listeners=[["click",this.click]]}},{key:"refresh",value:function(){this.grid=new Array(this.m);for(var t=0;t<this.m;t+=1)this.grid[t]=new Array(this.n).fill(i.UNSET);this.hints.row.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),this.hints.column.forEach(function(t){t.isCorrect=!1,t.unchanged=!1}),this.solve()}},{key:"solve",value:function(){var t=this;this.isBusy||(this.print(),this.isBusy=!0,this.startTime=Date.now(),this.worker.onmessage=function(e){var n=e.data;if(t.canvas.nonogram===t){if(t.scanner=n.scanner,t.grid=n.grid,t.hints=n.hints,"update"!==n.type)if(t.isBusy=!1,"error"===n.type){t.isError=!0;var i=t.scanner,r=i.direction,s=i.i;t.handleError(new Error("Bad hints at "+r+" "+(s+1)))}else"finish"===n.type&&(t.isError=!1,t.handleSuccess(Date.now()-t.startTime));t.print()}else t.worker.terminate()},this.worker.postMessage({delay:this.delay,grid:this.grid,hints:this.hints}))}},{key:"print",value:function(){this.printGrid(),this.printHints(),this.printScanner(),this.printController()}},{key:"printController",value:function(){var t=this.ctx,e=this.canvas,n=e.width,i=e.height,r=Math.min(n,i)/4,s=this.theme.filledColor;t.clearRect(2*n/3-1,2*i/3-1,n/3+1,i/3+1),this.isBusy||(t.save(),t.translate(.7*n,.7*i),t.drawImage(function(){var t=document.createElement("canvas"),e=r/10;t.width=r,t.height=r;var n=t.getContext("2d")||new CanvasRenderingContext2D;return n.translate(r/2,r/2),n.rotate(Math.PI),n.arc(0,0,r/2-e/2,Math.PI/2,Math.PI/3.9),n.lineWidth=e,n.strokeStyle=s,n.stroke(),n.beginPath(),n.moveTo((r/2+e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),n.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2-2*e)*Math.SQRT1_2),n.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),n.closePath(),n.fillStyle=s,n.fill(),t}(),0,0),t.restore())}},{key:"printScanner",value:function(){if(this.scanner){var t=this.ctx,e=this.canvas,n=e.width,i=e.height,r=2*n/3/(this.n+1);t.save(),t.translate(r/2,r/2),t.fillStyle=this.isError?this.theme.wrongColor:this.theme.correctColor,t.globalAlpha=.5,"row"===this.scanner.direction?t.fillRect(0,r*this.scanner.i,n,r):"column"===this.scanner.direction&&t.fillRect(r*this.scanner.i,0,r,i),t.restore()}}}]),e}(),T=function(t){function e(t,s,o){var h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=h.theme,c=void 0===l?{}:l,u=h.grid,d=void 0===u?[]:u,f=h.threshold,v=void 0===f?.5:f,g=h.onHintChange,m=void 0===g?function(){}:g;r(this,e);var w=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));w.mousedown=function(t){var e=w.canvas.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top,s=2*e.width/3/(w.n+1),o=w.getLocation(n,r);if("controller"===o)w.refresh();else if("grid"===o){w.draw.firstI=Math.floor(r/s-.5),w.draw.firstJ=Math.floor(n/s-.5);var a=w.grid[w.draw.firstI][w.draw.firstJ];w.draw.brush=a===i.FILLED?i.EMPTY:i.FILLED,w.isPressed=!0,w.paintCell(w.draw.firstI,w.draw.firstJ),w.draw.lastI=w.draw.firstI,w.draw.lastJ=w.draw.firstJ}},w.mousemove=function(t){if(w.isPressed){var e=w.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(w.n+1);if("grid"===w.getLocation(n,i)){var s=Math.floor(i/r-.5),o=Math.floor(n/r-.5);s===w.draw.lastI&&o===w.draw.lastJ||(void 0===w.draw.direction&&(s===w.draw.firstI?w.draw.direction="row":o===w.draw.firstJ&&(w.draw.direction="column")),("row"===w.draw.direction&&s===w.draw.firstI||"column"===w.draw.direction&&o===w.draw.firstJ)&&(w.paintCell(s,o),w.draw.lastI=s,w.draw.lastJ=o))}}},w.brushUp=function(){delete w.isPressed,w.draw={}},w.theme.filledColor=n.violet,w.theme.correctColor=n.violet,Object.assign(w.theme,c),w.threshold=v,w.handleHintChange=m,w.m=t,w.n=s,w.grid=new Array(w.m);for(var y=0;y<w.m;y+=1){w.grid[y]=new Array(w.n);for(var p=0;p<w.n;p+=1)d.length?w.grid[y][p]=d[y][p]?i.FILLED:i.EMPTY:w.grid[y][p]=Math.random()<w.threshold?i.FILLED:i.EMPTY}w.hints={row:new Array(t),column:new Array(s)};for(var E=0;E<w.m;E+=1)w.hints.row[E]=w.calculateHints("row",E),w.hints.row[E].isCorrect=!0;for(var T=0;T<w.n;T+=1)w.hints.column[T]=w.calculateHints("column",T),w.hints.column[T].isCorrect=!0;return w.initCanvas(o),w.draw={},w.print(),w.handleHintChange(w.hints.row,w.hints.column),w}return o(e,c),s(e,[{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown],["mousemove",this.mousemove],["mouseup",this.brushUp],["mouseleave",this.brushUp]]}},{key:"paintCell",value:function(t,e){this.grid[t][e]=this.draw.brush,this.hints.row[t]=this.calculateHints("row",t),this.hints.row[t].isCorrect=!0,this.hints.column[e]=this.calculateHints("column",e),this.hints.column[e].isCorrect=!0,this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"refresh",value:function(){for(var t=0;t<this.m;t+=1)for(var e=0;e<this.n;e+=1)this.grid[t][e]=Math.random()<this.threshold?i.FILLED:i.EMPTY;for(var n=0;n<this.m;n+=1)this.hints.row[n]=this.calculateHints("row",n),this.hints.row[n].isCorrect=!0;for(var r=0;r<this.n;r+=1)this.hints.column[r]=this.calculateHints("column",r),this.hints.column[r].isCorrect=!0;this.print(),this.handleHintChange(this.hints.row,this.hints.column)}},{key:"printController",value:function(){var t=this.ctx,e=this.canvas,n=e.width,i=e.height,r=Math.min(n,i)/4,s=this.theme.filledColor;t.clearRect(2*n/3-1,2*i/3-1,n/3+1,i/3+1),t.save(),t.translate(.7*n,.7*i),t.drawImage(function(){var t=document.createElement("canvas"),e=r/10;t.width=r,t.height=r;var n=t.getContext("2d")||new CanvasRenderingContext2D;return n.translate(r/2,r/2),n.arc(0,0,r/2-e/2,Math.PI/2,Math.PI/3.9),n.lineWidth=e,n.strokeStyle=s,n.stroke(),n.beginPath(),n.moveTo((r/2+e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),n.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2-2*e)*Math.SQRT1_2),n.lineTo((r/2-2*e)*Math.SQRT1_2,(r/2+e)*Math.SQRT1_2),n.closePath(),n.fillStyle=s,n.fill(),t}(),0,0),t.restore()}}]),e}(),L=function(t){function e(t,s,o){var h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},l=h.theme,c=void 0===l?{}:l,u=h.onSuccess,d=void 0===u?function(){}:u,f=h.onAnimationEnd,v=void 0===f?function(){}:f;r(this,e);var g=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));g.mousedown=function(t){var e=g.canvas.getBoundingClientRect(),n=t.clientX-e.left,r=t.clientY-e.top,s=2*e.width/3/(g.n+1),o=g.getLocation(n,r);if("controller"===o)g.switchBrush();else if("grid"===o){g.draw.firstI=Math.floor(r/s-.5),g.draw.firstJ=Math.floor(n/s-.5),g.draw.inverted=2===t.button;var a=g.grid[g.draw.firstI][g.draw.firstJ],h=g.brush;g.draw.inverted&&(h=g.brush===i.FILLED?i.EMPTY:i.FILLED),a!==i.UNSET&&h!==a||(g.draw.mode=h===a?"empty":"filling",g.isPressed=!0,g.switchCell(g.draw.firstI,g.draw.firstJ)),g.draw.lastI=g.draw.firstI,g.draw.lastJ=g.draw.firstJ}},g.mousemove=function(t){if(g.isPressed){var e=g.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,r=2*e.width/3/(g.n+1);if("grid"===g.getLocation(n,i)){var s=Math.floor(i/r-.5),o=Math.floor(n/r-.5);s===g.draw.lastI&&o===g.draw.lastJ||(void 0===g.draw.direction&&(s===g.draw.firstI?g.draw.direction="row":o===g.draw.firstJ&&(g.draw.direction="column")),("row"===g.draw.direction&&s===g.draw.firstI||"column"===g.draw.direction&&o===g.draw.firstJ)&&(g.switchCell(s,o),g.draw.lastI=s,g.draw.lastJ=o))}}},g.brushUp=function(){delete g.isPressed,g.draw={}},g.theme.filledColor=n.blue,g.theme.wrongColor=n.grey,g.theme.isMeshed=!0,Object.assign(g.theme,c),g.handleSuccess=d,g.handleAnimationEnd=v,g.hints={row:t.slice(),column:s.slice()},g.removeNonPositiveHints(),g.m=g.hints.row.length,g.n=g.hints.column.length,g.grid=new Array(g.m);for(var m=0;m<g.m;m+=1)g.grid[m]=new Array(g.n).fill(i.UNSET);return g.hints.row.forEach(function(t,e){t.isCorrect=g.isLineCorrect("row",e)}),g.hints.column.forEach(function(t,e){t.isCorrect=g.isLineCorrect("column",e)}),g.initCanvas(o),g.brush=i.FILLED,g.draw={},g.print(),g}return o(e,c),s(e,[{key:"calculateHints",value:function(t,e){var n=[];return this.getSingleLine(t,e).reduce(function(t,e){return e===i.FILLED&&n.push(t?n.pop()+1:1),e===i.FILLED},!1),n}},{key:"initListeners",value:function(){this.listeners=[["mousedown",this.mousedown],["mousemove",this.mousemove],["mouseup",this.brushUp],["mouseleave",this.brushUp]]}},{key:"switchBrush",value:function(){this.brush=this.brush===i.EMPTY?i.FILLED:i.EMPTY,this.printController()}},{key:"switchCell",value:function(t,e){var n=this.brush;this.draw.inverted&&(n=this.brush===i.FILLED?i.EMPTY:i.FILLED),n===i.FILLED&&this.grid[t][e]!==i.EMPTY?(this.grid[t][e]="filling"===this.draw.mode?i.FILLED:i.UNSET,this.hints.row[t].isCorrect=this.isLineCorrect("row",t),this.hints.column[e].isCorrect=this.isLineCorrect("column",e),this.print(),this.hints.row.every(function(t){return!!t.isCorrect})&&this.hints.column.every(function(t){return!!t.isCorrect})&&this.succeed()):n===i.EMPTY&&this.grid[t][e]!==i.FILLED&&(this.grid[t][e]="filling"===this.draw.mode?i.EMPTY:i.UNSET,this.print())}},{key:"printCell",value:function(t){var e=this.ctx,r=2*this.canvas.width/3/(this.n+1);switch(t){case i.FILLED:e.fillStyle=this.theme.filledColor,e.fillRect(.05*-r,.05*-r,1.1*r,1.1*r);break;case i.EMPTY:e.strokeStyle=n.red,e.lineWidth=r/15,e.beginPath(),e.moveTo(.3*r,.3*r),e.lineTo(.7*r,.7*r),e.moveTo(.3*r,.7*r),e.lineTo(.7*r,.3*r),e.stroke()}}},{key:"printController",value:function(){function t(){r.save(),r.translate(c,0),r.fillStyle=this.theme.meshColor,r.fillRect(0,0,l,l),r.fillStyle=this.theme.filledColor,r.fillRect(u,u,d,d),r.restore()}function e(){r.save(),r.translate(0,c),r.fillStyle=this.theme.meshColor,r.fillRect(0,0,l,l),r.clearRect(u,u,d,d),r.strokeStyle=n.red,r.lineWidth=u,r.beginPath(),r.moveTo(.3*l,.3*l),r.lineTo(.7*l,.7*l),r.moveTo(.3*l,.7*l),r.lineTo(.7*l,.3*l),r.stroke(),r.restore()}var r=this.ctx,s=this.canvas,o=s.width,a=s.height,h=Math.min(o,a)/4,l=3*h/4,c=h/4,u=h/20,d=l-2*u;r.clearRect(2*o/3-1,2*a/3-1,o/3+1,a/3+1),r.save(),r.translate(.7*o,.7*a),this.brush===i.FILLED?(e.call(this),t.call(this)):this.brush===i.EMPTY&&(t.call(this),e.call(this)),r.restore()}},{key:"succeed",value:function(){function t(t){return 1+Math.pow(t-1,3)}var e=this;this.handleSuccess(),this.listeners.forEach(function(t){var n=h(t,2),i=n[0],r=n[1];e.canvas.removeEventListener(i,r)});var i=this.ctx,r=this.canvas,s=r.width,o=r.height,a=Math.min(s,o)/4,l=i.getImageData(0,0,s,o),c=function(){var t=2*a,e=t/10,i=document.createElement("canvas");i.width=t,i.height=t;var r=i.getContext("2d")||new CanvasRenderingContext2D;return r.translate(t/3,5*t/6),r.rotate(-Math.PI/4),r.fillStyle=n.green,r.fillRect(0,0,e,-t*Math.SQRT2/3),r.fillRect(0,0,t*Math.SQRT2*2/3,-e),i}(),u=0;!function n(){i.putImageData(l,0,0),u+=.03,i.globalAlpha=t(u),i.clearRect(2*s/3,2*o/3,s/3,o/3),i.drawImage(c,.7*s-(1-t(u))*a/2,.7*o-(1-t(u))*a/2,(2-t(u))*a,(2-t(u))*a),u<=1?requestAnimationFrame(n):e.handleAnimationEnd()}()}}]),e}();return t.Solver=E,t.Editor=T,t.Game=L,t}({});
