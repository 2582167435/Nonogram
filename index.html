<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>Nonogram</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <script src="nonogram.min.js"></script>
  <script>
    onload = function () {
      var pres = document.querySelectorAll('pre');
      for (var i in pres) {
        eval(pres[i].innerHTML);
      }
      var canvases = document.querySelectorAll('canvas');
      for (var i in canvases) {
        canvases[i].title = canvases[i].id;
      }
      document.getElementById('parse-json').addEventListener('click', function () {
        document.getElementById('txt-row-hints2').value = document.getElementById('txt-row-hints2').value.replace(/(\]|\})[^\d\]\}]+/g, '\n').replace(/[^\d\n]+/g, '  ').replace(/[ \t]*\n[ \t]*/g, '\n').trim();
        document.getElementById('txt-col-hints2').value = document.getElementById('txt-col-hints2').value.replace(/(\]|\})[^\d\]\}]+/g, '\n').replace(/[^\d\n]+/g, '  ').replace(/[ \t]*\n[ \t]*/g, '\n').trim();
      });
    };
  </script>
  <style>
    canvas {
      width: 100%;
    }
    textarea {
      resize: vertical;
    }
  </style>
</head>

<body class="container">
  <h1 id="handsomeone-s-nonogram-demo">HandsomeOne's Nonogram Demo</h1>
  <h2 id="basic-examples">Basic Examples</h2>
  <hr>
  <h3 id="nonogramedit"><code>NonogramEdit</code></h3>
  <div class="row">
    <div class="col-md-4">
      <canvas id="edit1"></canvas>
    </div>
    <div class="col-md-8">
      <pre>
new nonogram.Editor(4, 8, 'edit1', {
  threshold: 0.2,
  isMeshed: true,
  boldMeshGap: 2,
});</pre>
    </div>
  </div>
  <div class="row">
    <div class="col-md-8">
      <pre>
new nonogram.Editor(2, 4, 'edit2', {
  grid: [[1, 0, 1, 0], [0, 1, 0, 1]],
  backgroundColor: '#eee',
});</pre>
    </div>
    <div class="col-md-4">
      <canvas id="edit2"></canvas>
    </div>
  </div>
  <hr>
  <h3 id="nonogramplay"><code>NonogramPlay</code></h3>
  <div class="row">
    <div class="col-md-4">
      <canvas id="play1"></canvas>
    </div>
    <div class="col-md-8">
      <pre>
new nonogram.Game([[1,1], [1,1]], [[1], [1], [1], [1]], 'play1', {
  filledColor: '#0c6',
  correctColor: '#0c6',
});</pre>
    </div>
  </div>
  <div class="row">
    <div class="col-md-8">
      <pre>
new nonogram.Game([[1,1], [1,1]], [[2], [], [2], []], 'play2');</pre>
    </div>
    <div class="col-md-4">
      <canvas id="play2"></canvas>
    </div>
  </div>
  <hr>
  <h3 id="nonogramsolve"><code>NonogramSolve</code></h3>
  <div class="row">
    <div class="col-md-4">
      <canvas id="solve1"></canvas>
    </div>
    <div class="col-md-8">
      <pre>
new nonogram.Solver([[1,1], [1,1]], [[2], [], [2], []], 'solve1', {
  delay: 200,
}).solve();</pre>
    </div>
  </div>
  <div class="row">
    <div class="col-md-3">
      <pre>
window._rows = [
  [7, 2, 2, 7],
  [1, 1, 1, 2, 1, 1],
  [1, 3, 1, 3, 1, 1, 3, 1],
  [1, 3, 1, 2, 1, 1, 3, 1],
  [1, 3, 1, 2, 1, 3, 1],
  [1, 1, 2, 2, 1, 1],
  [7, 1, 1, 1, 7],
  [2],
  [2, 3, 2, 1, 4],
  [1, 1, 3, 3, 2, 1],
  [3, 1, 3, 2, 2],
  [1, 1, 1, 3, 1, 1],
  [1, 5, 1, 1, 1, 1],
  [1, 1, 1, 1, 3, 1],
  [7, 1, 1],
  [1, 1, 1, 1, 1, 1, 1, 1],
  [1, 3, 1, 1, 1, 2, 2],
  [1, 3, 1, 2, 1, 2, 1, 1],
  [1, 3, 1, 1, 1, 2],
  [1, 1, 2, 1, 1],
  [7, 1, 3, 1]
];</pre>
    </div>
    <div class="col-md-3">
      <pre>
window._cols = [
  [7, 1, 2, 7],
  [1, 1, 1, 1, 1, 1],
  [1, 3, 1, 1, 1, 3, 1],
  [1, 3, 1, 1, 1, 1, 3, 1],
  [1, 3, 1, 1, 1, 1, 3, 1],
  [1, 1, 2, 1, 1],
  [7, 1, 1, 1, 7],
  [4],
  [4, 2, 2, 2, 2, 2],
  [1, 2, 1, 1, 1, 2, 3],
  [1, 2, 2, 2],
  [2, 3, 1, 1, 1, 1, 1],
  [3, 3, 2, 3, 1, 1],
  [1, 1, 3, 2],
  [7, 1, 1],
  [1, 1, 1, 1, 1, 1, 1],
  [1, 3, 1, 3, 2, 3],
  [1, 3, 1, 2, 2, 1, 1],
  [1, 3, 1, 1, 1, 1, 1],
  [1, 1, 5, 3],
  [7, 1, 1, 2, 1]
];</pre>
    </div>
    <div class="col-md-2">
      <pre>
new nonogram.Solver(
  window._rows,
  window._cols,
  'solve2').solve();</pre>
    </div>
    <div class="col-md-4">
      <canvas id="solve2"></canvas>
    </div>
  </div>
  <h2 id="advanced-usages">Advanced Usages</h2>
  <hr>
  <h3 id="nonogram-generator">Create Your Own Nonogram</h3>
  <p>
    Here is an example showing how to use listeners to create <code>nonogram.Game</code> and <code>nonogram.Solver</code> instances automatically.
  </p>
  <div class="row">
    <div class="col-md-3">
      <div class="form-group">
        <label for="m">Number of rows</label>
        <input type="number" id="m" class="form-control" min="1" max="20" step="1" value="6" required="">
      </div>
      <div class="form-group">
        <label for="n">Number of columns</label>
        <input type="number" id="n" class="form-control" min="1" max="20" step="1" value="6" required="">
      </div>
      <div class="form-group">
        <label for="threshold">threshold</label>
        <input type="range" id="threshold" class="form-control" min="0" max="1" step="0.01" value="0.5">
      </div>
    </div>
    <div class="col-md-3">
      <canvas id="adv-edit1"></canvas>
    </div>
    <div class="col-md-3">
      <canvas id="adv-solve1"></canvas>
    </div>
    <div class="col-md-3">
      <canvas id="adv-play1"></canvas>
    </div>
  </div>
  <pre>
function newCustomNonogram() {
  new nonogram.Editor(
    parseInt(document.getElementById('m').value),
    parseInt(document.getElementById('n').value),
    'adv-edit1',
    {
      threshold: parseFloat(document.getElementById('threshold').value),
      onHintChange: function (rowHints, colHints) {
        new nonogram.Game(rowHints, colHints, 'adv-play1', { boldMeshGap: 3 });
        new nonogram.Solver(rowHints, colHints, 'adv-solve1').solve();
      }
    }
  );
}
document.getElementById('m').addEventListener('change', newCustomNonogram);
document.getElementById('n').addEventListener('change', newCustomNonogram);
document.getElementById('threshold').addEventListener('change', newCustomNonogram);
newCustomNonogram();</pre>
  <hr>
  <h3 id="nonogram-solver">Nonogram Solver</h3>
  <p>This example shows how to solve the nonogram by given hints, which are separated by newlines and commas.</p>
  <p class="text-primary">Put your <code>rowHints</code> in the first textarea, <code>rowHints</code> in the second textarea.
  One row (or column) a line, numbers separated by any non-numerical characters.
  To represent an empty row (or column), you can use an empty line, or a line including the number <code>0</code> as well.
  However, empty lines at two ends will be dropped, since they are really unnecessary.</p>
  <p class="text-warning"><b>If the process end with an error, please check your input carefully.</b></p>
  <div class="row form-group">
    <div class="col-md-4">
      <textarea id="txt-row-hints2" class="form-control form-group" rows="15" placeholder="rowHints...">5
9
11
13
2  3  2
4  4  3
3  3  3
15
2  9  2
2  9  2
2  7  2
3  5  3
3  3
9
5</textarea>
      <input type="range" id="delay" class="form-control form-group" min="0" max="500" step="50" title="delay" value="50">
      <p class="text-primary">
        Delay: 0~500ms. If set to 0, then <code>demoMode</code> will be turned off.
      </p>
    </div>
    <div class="col-md-4">
      <textarea id="txt-col-hints2" class="form-control form-group" rows="15" placeholder="colHints...">5
9
6  3
3  1  3  3
3  4  2
4  5  2
12  2
12  2
12  2
4  1  5  2
3  4  2
3  3  3
6  3
9
5</textarea>
      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <button id="parse-json" class="btn btn-info btn-block">Parse</button>
          </div>
          <p class="text-primary">
            Parse JSON-like strings or anything.
          </p>
        </div>
        <div class="col-md-6">
          <div class="form-group">          
            <button id="btn-solve2" class="btn btn-primary btn-block">Solve!</button>
          </div>
          <p class="text-primary">
            You can check the console (press <kbd>F12</kbd>) to find out how much time is cost.
          </p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <canvas id="adv-solve2"></canvas>
    </div>
  </div>
  <pre>
function parseArray(str) {
  str = str.replace(/[^\d\n]+/g, ' ').trim();
  var hints = str.split('\n');
  hints.forEach(function (str, i, hints) {
    var t = str.match(/\d+/g) || [];
    t = t.map(parseFloat);
    hints[i] = t.filter(Math.sign);
  });
  return hints;
}
document.getElementById('btn-solve2').addEventListener('click', function () {
  var delay = +document.getElementById('delay').value;
  new nonogram.Solver(
    parseArray(document.getElementById('txt-row-hints2').value),
    parseArray(document.getElementById('txt-col-hints2').value),
    'adv-solve2',
    {
      filledColor: '#0c6',
      correctColor: '#0c6',
      wrongColor: '#999',
      unsetColor: '#ccc',
      meshColor: '#09f',
      isMeshed: true,
      isBoldMeshOnly: true,
      isMeshOnTop: true,
      delay: delay,
      demoMode: !!delay,
      onSucceed: function (time) {
        console.log('Solved in ' + time + 'ms.')
      }
    }).solve();
});</pre>
</body>

</html>